import{eo as O,ep as y,eq as T,er as S,u as q,d as G,r as C,es as H,q as L,cG as N,ax as B,a as e,aj as z,ak as f,F as m,al as u,bw as K,o as Q,br as U}from"../index-31181b4d.js";const V=(v,s,o)=>{const i=Object.entries(v).map(([a,t])=>{const r=o.get(a);if(typeof t=="boolean")return[a,t];if(r)return[a,S(t).add([s,"No reason"]).toJS()];{const d=S(t).find(p=>p[0]===s);return d?[a,S(t).delete(d).toJS()]:[a,t]}});return Object.fromEntries(i)},W=(v,s)=>(o,i)=>o(O()).then(()=>{const a=i().admin.get("configs"),t=y.toSimplePolicy(a),r=V(t,v,s),d=y.fromSimplePolicy(r,i);return o(T(d.toJS()))});var F=Q({mediaRemoval:{id:"edit_federation.media_removal",defaultMessage:"Strip media"},forceNsfw:{id:"edit_federation.force_nsfw",defaultMessage:"Force attachments to be marked sensitive"},unlisted:{id:"edit_federation.unlisted",defaultMessage:"Force posts unlisted"},followersOnly:{id:"edit_federation.followers_only",defaultMessage:"Hide posts except to followers"},save:{id:"edit_federation.save",defaultMessage:"Save"},success:{id:"edit_federation.success",defaultMessage:"{host} federation was updated"}}),Y=function(s){var o=s.host,i=s.onClose,a=q(),t=G(),r=C.useCallback(H(),[]),d=L(function(h){return r(h,o)}),p=C.useState(N()),R=B(p,2),_=R[0],M=R[1];C.useEffect(function(){M(d.get("federation"))},[d]);var g=function(b){return function(c){var w=c.target;M(_.set(b,w.checked))}},x=function(b){var c=b.target.checked,w=_.merge({avatar_removal:c,banner_removal:c,media_removal:c});M(w)},D=function(){t(W(o,_)).then(function(){return U.success(a.formatMessage(F.success,{host:o}))}).catch(function(){}),i()},n=_.toJS(),E=n.avatar_removal,I=n.banner_removal,A=n.federated_timeline_removal,j=n.followers_only,J=n.media_nsfw,k=n.media_removal,l=n.reject,P=E&&I&&k;return e(K,{onClose:i,title:o,confirmationAction:D,confirmationText:a.formatMessage(F.save)},void 0,e(z,{},void 0,e(f,{label:e(m,{id:"edit_federation.reject",defaultMessage:"Reject all activities"})},void 0,e(u,{checked:l,onChange:g("reject"),id:"reject"})),e(f,{label:e(m,{id:"edit_federation.media_removal",defaultMessage:"Strip media"})},void 0,e(u,{checked:P,onChange:x,id:"media_removal",disabled:l})),e(f,{label:e(m,{id:"edit_federation.force_nsfw",defaultMessage:"Force attachments to be marked sensitive"})},void 0,e(u,{checked:J,onChange:g("media_nsfw"),id:"media_nsfw",disabled:l||k})),e(f,{label:e(m,{id:"edit_federation.followers_only",defaultMessage:"Hide posts except to followers"})},void 0,e(u,{checked:j,onChange:g("followers_only"),id:"followers_only",disabled:l})),e(f,{label:e(m,{id:"edit_federation.unlisted",defaultMessage:"Force posts unlisted"})},void 0,e(u,{checked:A,onChange:g("federated_timeline_removal"),id:"federated_timeline_removal",disabled:l||j}))))};export{Y as default};
