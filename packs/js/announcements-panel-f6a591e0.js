import{a9 as I,r as h,R as j,f as x,ax as R,a as r,gL as S,e5 as k,jy as N,jz as M,j as P,W as C,jA as Y,g as H,y as z,d9 as A,a3 as K,M as T,cE as B,d as V,q as L,a2 as W,H as _,F as $,jB as q,jC as G}from"../index-4976718e.js";import{R as J}from"./index-767dd6e7.js";import{W as O}from"./widget-f0a68aab.js";import"./warning-07d0fac9.js";import"./arrow-right-b75290c7.js";var Q=void 0,U=function(a){var t=a.announcement,s=I(),d=h.useRef(null);h.useEffect(function(){c()});var v=function(i,e){e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),s.push("/@".concat(i.acct)))},m=function(i,e){i=i.replace(/^#/,"").toLowerCase(),e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),e.stopPropagation(),s.push("/tags/".concat(i)))},o=function(i,e){e.button===0&&!(e.ctrlKey||e.metaKey)&&(e.preventDefault(),s.push(i))},c=function(){if(d.current){var i=d.current.querySelectorAll("a");i.forEach(function(e){var u,n;if(!e.classList.contains("status-link")){e.classList.add("status-link"),e.setAttribute("rel","nofollow noopener"),e.setAttribute("target","_blank");var f=t.mentions.find(function(y){return e.href==="".concat(y.url)});if(f)e.addEventListener("click",v.bind(e,f),!1),e.setAttribute("title",f.acct);else if(((u=e.textContent)===null||u===void 0?void 0:u.charAt(0))==="#"||((n=e.previousSibling)===null||n===void 0||(n=n.textContent)===null||n===void 0?void 0:n.charAt(e.previousSibling.textContent.length-1))==="#")e.addEventListener("click",m.bind(e,e.text),!1);else{var g=t.statuses.get(e.href);g&&e.addEventListener("click",o.bind(Q,g),!1),e.setAttribute("title",e.href),e.classList.add("unhandled-link")}}})}};return j.createElement("div",{className:"translate text-sm",ref:d,dangerouslySetInnerHTML:{__html:t.contentHtml}})},F=function(a){return a<0?0:a<=1?a:"1+"},X=function(a){var t=a.value,s=a.obfuscate,d=x().get("reduceMotion"),v=h.useState(1),m=R(v,2),o=m[0],c=m[1],l=h.useState(t),i=R(l,2),e=i[0],u=i[1];h.useEffect(function(){e!==void 0&&(t>e?c(1):t<e&&c(-1)),u(t)},[t]);var n=function(){return{y:-1*o}},f=function(){return{y:k(1*o,{damping:35,stiffness:400})}};if(d)return s?j.createElement(j.Fragment,null,F(e)):r(S,{value:e});var g=[{key:"".concat(e),data:e,style:{y:k(0,{damping:35,stiffness:400})}}];return r(N,{styles:g,willEnter:n,willLeave:f},void 0,function(y){return r("span",{className:"relative inline-flex flex-col items-stretch overflow-hidden"},void 0,y.map(function(b){var D=b.key,E=b.data,w=b.style;return r("span",{style:{position:o*w.y>0?"absolute":"static",transform:"translateY(".concat(w.y*100,"%)")}},D,s?F(E):r(S,{value:E}))}))})},Z=function(a){var t=a.emoji,s=a.emojiMap,d=a.hovered,v=x().get("autoPlayGif");if(M[t]){var m=M[t],o=m.filename,c=m.shortCode,l=c?":".concat(c,":"):"";return r("img",{draggable:"false",className:"emojione m-0 block",alt:t,title:l,src:P("packs/emoji/".concat(o,".svg"))})}else if(s.get(t)){var i=v||d?s.getIn([t,"url"]):s.getIn([t,"static_url"]),e=":".concat(t,":");return r("img",{draggable:"false",className:"emojione m-0 block",alt:e,title:e,src:i})}else return null},ee=function(a){var t=a.announcementId,s=a.reaction,d=a.addReaction,v=a.removeReaction,m=a.emojiMap,o=a.style,c=h.useState(!1),l=R(c,2),i=l[0],e=l[1],u=function(){s.me?v(t,s.name):d(t,s.name)},n=function(){return e(!0)},f=function(){return e(!1)},g=s.name;return M[g]&&(g=M[g].shortCode),r("button",{className:C("flex shrink-0 items-center gap-1.5 rounded-sm bg-gray-100 px-1.5 py-1 transition-colors dark:bg-primary-900",{"bg-gray-200 dark:bg-primary-800":i,"bg-primary-200 dark:bg-primary-500":s.me}),onClick:u,onMouseEnter:n,onMouseLeave:f,title:":".concat(g,":"),style:o},void 0,r("span",{className:"block h-4 w-4"},void 0,r(Z,{hovered:i,emoji:s.name,emojiMap:m})),r("span",{className:"block min-w-[9px] text-center text-xs font-medium text-primary-600 dark:text-white"},void 0,r(X,{value:s.count})))},te=function(a){var t=a.announcementId,s=a.reactions,d=a.addReaction,v=a.removeReaction,m=a.emojiMap,o=x().get("reduceMotion"),c=function(f){d(t,f.native.replace(/:/g,""))},l=function(){return{scale:o?1:0}},i=function(){return{scale:o?0:k(0,{stiffness:170,damping:26})}},e=s.filter(function(n){return n.count>0}),u=e.map(function(n){return{key:n.name,data:n,style:{scale:o?1:k(1,{stiffness:150,damping:13})}}}).toArray();return r(N,{styles:u,willEnter:l,willLeave:i},void 0,function(n){return r("div",{className:C("flex flex-wrap items-center gap-1",{"reactions-bar--empty":e.isEmpty()})},void 0,n.map(function(f){var g=f.key,y=f.data,b=f.style;return r(ee,{reaction:y,style:{transform:"scale(".concat(b.scale,")"),position:b.scale<.5?"absolute":"static"},announcementId:t,addReaction:d,removeReaction:v,emojiMap:m},g)}),e.size<8&&r(Y,{onPickEmoji:c}))})},ae=function(a){var t=a.announcement,s=a.addReaction,d=a.removeReaction,v=a.emojiMap,m=H(),o=t.starts_at&&new Date(t.starts_at),c=t.ends_at&&new Date(t.ends_at),l=new Date,i=o&&c,e=i&&o.getFullYear()===c.getFullYear()&&c.getFullYear()===l.getFullYear(),u=i&&o.getDate()===c.getDate()&&o.getMonth()===c.getMonth()&&o.getFullYear()===c.getFullYear(),n=t.all_day;return r(K,{className:"w-full",space:2},void 0,i&&r(z,{theme:"muted"},void 0,r(A,{value:o,hour12:!0,year:e||o.getFullYear()===l.getFullYear()?void 0:"numeric",month:"short",day:"2-digit",hour:n?void 0:"numeric",minute:n?void 0:"2-digit"})," ","-"," ",r(A,{value:c,hour12:!0,year:e||c.getFullYear()===l.getFullYear()?void 0:"numeric",month:u?void 0:"short",day:u?void 0:"2-digit",hour:n?void 0:"numeric",minute:n?void 0:"2-digit"})),r(U,{announcement:t}),m.announcementsReactions&&r(te,{reactions:t.reactions,announcementId:t.id,addReaction:s,removeReaction:d,emojiMap:v}))},ne=T([function(p){return p.custom_emojis}],function(p){return p.reduce(function(a,t){return a.set(t.get("shortcode"),t)},B())}),ce=function(){var a=V(),t=L(function(e){return ne(e)}),s=h.useState(0),d=R(s,2),v=d[0],m=d[1],o=L(function(e){return e.announcements.items}),c=function(u,n){return a(q(u,n))},l=function(u,n){return a(G(u,n))};if(o.size===0)return null;var i=function(u){m(u%o.size)};return r(O,{title:r($,{id:"announcements.title",defaultMessage:"Announcements"})},void 0,r(W,{className:"relative",size:"md",variant:"rounded"},void 0,r(J,{animateHeight:!0,index:v,onChangeIndex:i},void 0,o.map(function(e){return r(ae,{announcement:e,emojiMap:t,addReaction:c,removeReaction:l},e.id)}).reverse()),o.size>1&&r(_,{space:2,alignItems:"center",justifyContent:"center",className:"relative"},void 0,o.map(function(e,u){return r("button",{tabIndex:0,onClick:function(){return m(u)},className:C({"w-2 h-2 rounded-full focus:ring-primary-600 focus:ring-2 focus:ring-offset-2":!0,"bg-gray-200 hover:bg-gray-300":u!==v,"bg-primary-600":u===v})},u)}))))};export{ce as default};
