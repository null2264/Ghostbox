import{cU as Z,cV as Re,cW as we,cX as Oe,cY as Ne,cZ as ke,c_ as le,c$ as J,d0 as Te,d1 as Ee,d2 as Ae,d3 as De,d4 as Le,q as j,aY as de,d as ce,g as ve,w as fe,a as e,H as B,F as b,E as $e,W as D,y as H,d5 as ze,L as me,d6 as Fe,O as U,aH as A,u as ge,r as O,d7 as Pe,cL as qe,R as M,b5 as Ue,cK as je,d8 as Be,d9 as He,da as ae,A as K,db as Ve,dc as We,dd as Qe,t as Ge,a3 as Y,cy as Ke,a2 as Ye,ae as ne,a8 as L,az as Ze,aS as pe,M as he,bb as Je,f as Xe,de as re,ax as et,df as tt,dg as at,bN as se,dh as nt}from"../index-c4c40436.js";import{S as rt}from"./scrollable-list-01deb2c5.js";import{P as st}from"./pending-status-0f78398e.js";import{S as ot}from"./status-container-faf50da4.js";var it=Z,ut=Re,lt=we,dt=Oe,ct=Ne,vt=ke,ft=[].unshift(0)!==1,mt=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(o){return o instanceof TypeError}},gt=ft||!mt();it({target:"Array",proto:!0,arity:1,forced:gt},{unshift:function(r){var t=ut(this),s=lt(t),l=arguments.length;if(l){vt(s+l);for(var a=s;a--;){var d=a+l;a in t?t[d]=t[a]:ct(t,d)}for(var i=0;i<l;i++)t[i]=arguments[i]}return dt(t,s+l)}});var pt=Z,ht=J,oe=le.clear;pt({global:!0,bind:!0,enumerable:!0,forced:ht.clearImmediate!==oe},{clearImmediate:oe});var bt=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",be=J,yt=Le,St=Ee,Mt=bt,It=Te,xt=Ae,_t=De,Ct=be.Function,Rt=/MSIE .\./.test(It)||Mt&&function(){var o=be.Bun.version.split(".");return o.length<3||o[0]==="0"&&(o[1]<3||o[1]==="3"&&o[2]==="0")}(),wt=function(o,r){var t=r?2:1;return Rt?function(s,l){var a=_t(arguments.length,1)>t,d=St(s)?s:Ct(s),i=a?xt(arguments,t):[],c=a?function(){yt(d,this,i)}:d;return r?o(c,l):o(c)}:o},Ot=Z,ye=J,ie=le.set,Nt=wt,ue=ye.setImmediate?Nt(ie,!1):ie;Ot({global:!0,bind:!0,enumerable:!0,forced:ye.setImmediate!==ue},{setImmediate:ue});var kt=function(r){var t=r.status,s=j(function(m){var f=m.me;return f}),l=de(),a=l.allowedEmoji,d=ce(),i=ve(),c=t.account;if(!c||fe(c)!=="object")return null;var y=function(){d(A("UNAUTHORIZED"))},I=function(f,h){d(A("REBLOGS",{username:f,statusId:h}))},C=function(f,h){d(A("FAVOURITES",{username:f,statusId:h}))},v=function(f,h){d(A("DISLIKES",{username:f,statusId:h}))},x=function(f,h){d(A("REACTIONS",{username:f,statusId:h}))},$=function(){return Fe(U(t.pleroma.get("emoji_reactions")),t.favourites_count,t.favourited,a)},N=function(f){f.preventDefault(),s?I(c.acct,t.id):y()},R=function(){return t.reblogs_count?e(q,{count:t.reblogs_count,onClick:N},void 0,e(b,{id:"status.interactions.reblogs",defaultMessage:"{count, plural, one {Repost} other {Reposts}}",values:{count:t.reblogs_count}})):null},S=function(){return t.quotes_count?e(q,{count:t.quotes_count,to:"/@".concat(t.getIn(["account","acct"]),"/posts/").concat(t.id,"/quotes")},void 0,e(b,{id:"status.interactions.quotes",defaultMessage:"{count, plural, one {Quote} other {Quotes}}",values:{count:t.quotes_count}})):null},p=function(f){f.preventDefault(),s?C(c.acct,t.id):y()},k=function(f){f.preventDefault(),s?v(c.acct,t.id):y()},z=function(){return t.favourites_count?e(q,{count:t.favourites_count,onClick:i.exposableReactions?p:void 0},void 0,e(b,{id:"status.interactions.favourites",defaultMessage:"{count, plural, one {Like} other {Likes}}",values:{count:t.favourites_count}})):null},Q=function(){var f=t.dislikes_count;return f?e(q,{count:t.favourites_count,onClick:i.exposableReactions?k:void 0},void 0,e(b,{id:"status.interactions.dislikes",defaultMessage:"{count, plural, one {Dislike} other {Dislikes}}",values:{count:f}})):null},V=function(){if(!s)return y();x(c.acct,t.id)},W=function(){var f=$(),h=f.reduce(function(_,F){return _+F.get("count")},0);return h?e(q,{count:h,onClick:i.exposableReactions?V:void 0},void 0,e(B,{space:.5,alignItems:"center"},void 0,f.take(3).map(function(_,F){return e($e,{className:"h-4.5 w-4.5 flex-none",emoji:_.get("name"),src:_.get("url")},F)}))):null};return e(B,{space:3},void 0,R(),S(),i.emojiReacts?W():z(),Q())},q=function(r){var t=r.count,s=r.children,l=r.onClick,a=r.to,d=ve(),i=D({"text-gray-600 dark:text-gray-700":!0,"hover:underline":d.exposableReactions,"cursor-default":!d.exposableReactions}),c=e(B,{space:1,alignItems:"center"},void 0,e(H,{weight:"bold"},void 0,ze(t)),e(H,{tag:"div",theme:"muted"},void 0,s));return a?e(me,{to:a,className:i},void 0,c):e("button",{type:"button",onClick:l,className:i},void 0,c)},Tt=function(r){var t=r.status,s=r.onOpenCompareHistoryModal,l=r.onToggleMediaVisibility,a=r.showMedia,d=r.withMedia,i=d===void 0?!0:d,c=ge(),y=O.useRef(null),I=function(){s(t)},C=function(){return t.group?e("div",{className:"mb-4"},void 0,e(ae,{avatarSize:42,icon:e(K,{src:Ve,className:"h-4 w-4 text-primary-600 dark:text-accent-blue"}),text:e(b,{id:"status.group",defaultMessage:"Posted in {group}",values:{group:e(me,{to:"/group/".concat(t.group.slug),className:"hover:underline"},void 0,e("bdi",{className:"truncate"},void 0,e("strong",{className:"text-gray-800 dark:text-gray-200"},void 0,e("span",{dangerouslySetInnerHTML:{__html:t.group.display_name_html}}))))}})})):e(ae,{visibility:v.visibility})},v=Pe(t);if(!v)return null;var x=v.account;if(!x||fe(x)!=="object")return null;var $=v.visibility==="self",N=v.sensitive,R=null,S;return v.quote&&(v.pleroma.get("quote_visible",!0)===!1?S=e("div",{className:"quoted-actualStatus-tombstone"},void 0,e("p",{},void 0,e(b,{id:"actualStatuses.quote_tombstone",defaultMessage:"Post is unavailable."}))):S=e(qe,{statusId:v.quote})),v.visibility==="direct"?R=e(K,{className:"h-4 w-4 text-gray-700 dark:text-gray-600",src:We}):v.visibility==="private"&&(R=e(K,{className:"h-4 w-4 text-gray-700 dark:text-gray-600",src:Qe})),e("div",{className:"border-box"},void 0,M.createElement("div",{ref:y,className:"detailed-actualStatus",tabIndex:-1},e("div",{className:"mb-4"},void 0,C(),e(Ue,{account:x,avatarSize:42,hideActions:!0,approvalStatus:v.approval_status},x.id)),e(je,{status:v}),e(Be,{showMedia:a||!1,isSensitive:$||N,onToggleMediaVisibility:l,additionalMediaCondition:i,quote:S,hasMedia:!!(S||v.card||v.media_attachments.size>0),contentOption:{status:v,textSize:"lg",translatable:!0}}),e(B,{justifyContent:"between",alignItems:"center",className:"py-3",wrap:!0},void 0,e(kt,{status:v}),e(B,{space:1,alignItems:"center"},void 0,R,e("span",{},void 0,e("a",{href:v.url,target:"_blank",rel:"noopener",className:"hover:underline"},void 0,e(H,{tag:"span",theme:"muted",size:"sm"},void 0,e(He,{value:new Date(v.created_at),hour12:!0,year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"2-digit"}))),v.edited_at&&M.createElement(M.Fragment,null," · ",e("div",{className:"inline hover:underline",onClick:I,role:"button",tabIndex:0},void 0,e(H,{tag:"span",theme:"muted",size:"sm"},void 0,e(b,{id:"actualStatus.edited",defaultMessage:"Edited {date}",values:{date:c.formatDate(new Date(v.edited_at),{hour12:!0,month:"short",day:"2-digit",hour:"numeric",minute:"2-digit"})}})))))))))},Et=function(){var r=Ge(),t=de(),s=t.displayCta;return s?e(Ye,{className:"space-y-6 px-6 py-12 text-center",variant:"rounded"},void 0,e(Y,{},void 0,e(Ke,{title:e(b,{id:"thread_login.title",defaultMessage:"Continue the conversation"})}),e(H,{},void 0,e(b,{id:"thread_login.message",defaultMessage:"Join {siteTitle} to get the full story and details.",values:{siteTitle:r.title}}))),e(Y,{space:4,className:"mx-auto max-w-xs"},void 0,e(ne,{theme:"tertiary",to:"/login",block:!0},void 0,e(b,{id:"thread_login.login",defaultMessage:"Log in"})),e(ne,{to:"/signup",block:!0},void 0,e(b,{id:"thread_login.signup",defaultMessage:"Sign up"})))):null},At=function(r){var t=r.id,s=r.focusedStatusId,l=j(function(c){return c.contexts.inReplyTos.get(t)}),a=j(function(c){return c.contexts.replies.get(t,L()).size}),d=j(function(c){return!!c.statuses.get(t)}),i=function(){var y=l&&l!==s,I=a>0,C=y||I;return C?e("div",{className:D("absolute left-5 z-[1] hidden w-0.5 bg-gray-200 rtl:left-auto rtl:right-5 dark:bg-primary-800",{"!block top-[calc(12px+42px+1.25rem)] h-[calc(100%-42px-8px-1rem)]":I})}):null};return e("div",{className:"thread__status"},void 0,i(),d?M.createElement(ot,Ze({},r,{showGroup:!1})):e(pe,{showPrivacyIndicator:!0,variant:"default"}))},Dt=he([function(o,r){return r},function(o){return o.contexts.inReplyTos}],function(o,r){for(var t=L(),s=o;s&&!t.includes(s);)t=L([s]).union(t),s=r.get(s);return t}),Lt=he([function(o,r){return r},function(o){return o.contexts.replies}],function(o,r){for(var t=L(),s=[o];s.length>0;){var l=s.shift();if(!l)break;var a=r.get(l);if(t.includes(l))break;o!==l&&(t=t.union([l])),a&&a.reverse().forEach(function(d){s.unshift(d)})}return t}),qt=function(r){var t=r.handleLoadMore,s=r.itemClassName,l=r.next,a=r.status,d=r.useWindowScroll,i=d===void 0?!0:d,c=r.withMedia,y=c===void 0?!0:c,I=ce(),C=ge(),v=Je(),x=v.account,$=Xe(),N=$.get("showSensitiveMedia"),R=(a==null?void 0:a.visibility)==="self",S=j(function(g){var n=L(),u=L();if(a){var P=a.id;n=Dt(g,g.contexts.inReplyTos.get(P)),u=Lt(g,P),n=n.delete(P).subtract(u),u=u.delete(P).subtract(n)}return{status:a,ancestorsIds:n,descendantsIds:u}}),p=S.ancestorsIds,k=S.descendantsIds,z=p.size;!i&&z!==0&&(z=p.size+1);var Q=O.useState((a==null?void 0:a.visibility)==="self"?!1:re(a,N)),V=et(Q,2),W=V[0],m=V[1],f=O.useRef(null),h=O.useRef(null),_=O.useRef(null),F=function(){m(!W)},X=function(n){if(n===(a==null?void 0:a.id))T(p.size-1);else{var u=U(p).indexOf(n);u===-1?(u=U(k).indexOf(n),T(p.size+u)):T(u-1)}},ee=function(n){if(n===(a==null?void 0:a.id))T(p.size+1);else{var u=U(p).indexOf(n);u===-1?(u=U(k).indexOf(n),T(p.size+u+2)):T(u+1)}},T=function(n){var u;i||(n=n+1),(u=_.current)===null||u===void 0||u.scrollIntoView({index:n,behavior:"smooth",done:function(){var E;(E=f.current)===null||E===void 0||(E=E.querySelector('[data-index="'.concat(n,'"] .focusable')))===null||E===void 0||E.focus()}})},Se=function(n){return e("div",{className:"py-4 pb-8"},void 0,e(nt,{id:n,onMoveUp:X,onMoveDown:ee},n))},Me=function(n){return e(At,{id:n,focusedStatusId:a.id,onMoveUp:X,onMoveDown:ee,contextType:"thread"},n)},Ie=function(n){var u=n.replace(/^末pending-/,"");return e(st,{idempotencyKey:u,thread:!0},n)},te=function(n){return n.map(function(u){return u.endsWith("-tombstone")?Se(u):u.startsWith("末pending-")?Ie(u):Me(u)})};O.useEffect(function(){m((a==null?void 0:a.visibility)==="self"?!1:re(a,N))},[a.id]),O.useEffect(function(){var g;(g=_.current)===null||g===void 0||g.scrollToIndex({index:p.size,offset:-146}),setImmediate(function(){var n;return(n=h.current)===null||n===void 0||(n=n.querySelector(".detailed-actualStatus"))===null||n===void 0?void 0:n.focus()})},[a.id,p.size]);var xe=function(n){I(A("COMPARE_HISTORY",{statusId:n.id}))},_e=p.size>0,G=k.size>0,Ce=e("div",{className:D({"pb-4":G})},a.id,M.createElement("div",{ref:h,className:"focusable relative",tabIndex:0,"aria-label":tt(C,a)},e(Tt,{status:a,showMedia:W,withMedia:y,onToggleMediaVisibility:F,onOpenCompareHistoryModal:xe}),R?null:M.createElement(M.Fragment,null,e("hr",{className:"-mx-4 mb-2 max-w-[100vw] border-t-2 dark:border-gray-800"}),e(at,{status:a,expandable:!1,space:"lg",withLabels:!0}))),G&&e("hr",{className:"-mx-4 mt-2 max-w-[100vw] border-t-2 dark:border-gray-800"})),w=[];return i||w.push(e("div",{className:"h-4"},"padding")),_e&&w.push.apply(w,se(te(p).toArray())),w.push(Ce),G&&w.push.apply(w,se(te(k).toArray())),e(Y,{space:2,className:D({"h-full":!i,"mt-2":i})},void 0,M.createElement("div",{ref:f,className:D("thread",{"h-full":!i})},M.createElement(rt,{id:"thread",ref:_,hasMore:!!l,onLoadMore:t,placeholderComponent:function(){return e(pe,{showPrivacyIndicator:!0,variant:"slim"})},initialTopMostItemIndex:z,useWindowScroll:i,itemClassName:s,className:D({"h-full":!i})},w)),!x&&e(Et,{}))};export{qt as T,At as a,Lt as g};
