import{d as q,r as s,aL as G,q as h,b9 as Q,at as D,kh as z,Q as K,aM as V,a as n,aC as j,aO as _,bL as B,e8 as H,a2 as J,R as E,F as X,aP as Y,aQ as Z,dg as ee,O as L}from"../index-384d6887.js";import{S as te}from"./scrollable-list-6f6370f5.js";import{P as ae}from"./pending-status-260a6418.js";import{g as re,a as ne}from"./thread-6a8ff73a.js";import"./index-9ae51821.js";import"./load-more-2ae55fa9.js";import"./poll-preview-f92327c0.js";import"./noop-d5111e21.js";import"./status-container-18d57bfb.js";var he=function(u){var l=q(),P=s.useCallback(G(),[]),r=h(function(a){return P(a,{id:u.params.statusId})}),f=h(function(a){return a.me}),d=h(function(a){var e=Q();if(r){var t=r.id;e=re(a,t),e=e.delete(t)}return e}),R=s.useState(!!r),S=D(R,2),v=S[0],y=S[1],k=s.useState(),b=D(k,2),c=b[0],g=b[1],T=s.useRef(null),M=s.useRef(null),N=function(){var a=Y(regeneratorRuntime.mark(function e(){var t,p,o,C;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=u.params,p=t.statusId,i.next=4,l(Z(p));case 4:o=i.sent,C=o.next,g(C);case 7:case"end":return i.stop()}},e)}));return function(){return a.apply(this,arguments)}}();s.useEffect(function(){N().then(function(){y(!0)}).catch(function(){y(!0)})},[u.params.statusId]),s.useEffect(function(){v&&f&&l(z("reply:".concat(u.params.statusId),r))},[v,f]);var I=function(e){var t=L(d).indexOf(e);x(t-1)},w=function(e){var t=L(d).indexOf(e);x(t+1)},x=function(e){var t;(t=M.current)===null||t===void 0||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var o=document.querySelector('#thread [data-index="'.concat(e,'"] .focusable'));o&&o.focus()}})},A=function(e){return n("div",{className:"py-4 pb-8"},void 0,n(ee,{id:e,onMoveUp:I,onMoveDown:w},e))},O=function(e){return n(ne,{id:e,focusedStatusId:r.id,onMoveUp:I,onMoveDown:w},e)},F=function(e){var t=e.replace(/^末pending-/,"");return n(ae,{idempotencyKey:t,thread:!0},e)},U=function(e){return e.map(function(t){return t.endsWith("-tombstone")?A(t):t.startsWith("末pending-")?F(t):O(t)})},W=s.useCallback(K(function(){c&&r&&l(V(r.id,c)).then(function(a){var e=a.next;g(e)}).catch(function(){})},300,{leading:!0}),[c,r]),$=d.size>0;if(!r&&v)return n(j,{});if(!r)return n(_,{showPrivacyIndicator:!0});var m=[];return $&&m.push.apply(m,B(U(d).toArray())),n(J,{space:2},void 0,f&&n("div",{className:"border-b border-solid border-gray-200 p-2 pt-0 dark:border-gray-800"},void 0,n(H,{id:"reply:".concat(r.id),autoFocus:!1,event:r.id})),E.createElement("div",{ref:T,className:"thread p-0 shadow-none sm:p-2"},E.createElement(te,{id:"thread",ref:M,hasMore:!!c,onLoadMore:W,placeholderComponent:function(){return n(_,{showPrivacyIndicator:!0,variant:"slim"})},initialTopMostItemIndex:0,emptyMessage:n(X,{id:"event.discussion.empty",defaultMessage:"No one has commented this event yet. When someone does, they will appear here."})},m)))};export{he as default};
