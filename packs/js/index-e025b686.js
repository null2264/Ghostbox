import{an as N,l as m,a7 as x,ao as q,ap as A,Y as E,A as D,I as L,aj as F,m as Q,n as v,a9 as W,a as z,aq as J,ar as T,ak as V,k as X,ab as K,af as Z,as as H,at as ee,au as te,al as ne,av as se,aw as ie,ax as oe,am as re,ay as ae}from"./browsertracing-f492ea54.js";function ce(s,t={}){const n=s.method&&s.method.toUpperCase();let e="",r="url";t.customRoute||s.route?(e=t.customRoute||`${s.baseUrl||""}${s.route&&s.route.path}`,r="route"):(s.originalUrl||s.url)&&(e=N(s.originalUrl||s.url||""));let c="";return t.method&&n&&(c+=n),t.method&&t.path&&(c+=" "),t.path&&e&&(c+=e),[c,r]}var Y;(function(s){const t="ok";s.Ok=t;const n="deadline_exceeded";s.DeadlineExceeded=n;const e="unauthenticated";s.Unauthenticated=e;const r="permission_denied";s.PermissionDenied=r;const c="not_found";s.NotFound=c;const a="resource_exhausted";s.ResourceExhausted=a;const o="invalid_argument";s.InvalidArgument=o;const i="unimplemented";s.Unimplemented=i;const l="unavailable";s.Unavailable=l;const u="internal_error";s.InternalError=u;const d="unknown_error";s.UnknownError=d;const g="cancelled";s.Cancelled=g;const p="already_exists";s.AlreadyExists=p;const f="failed_precondition";s.FailedPrecondition=f;const h="aborted";s.Aborted=h;const y="out_of_range";s.OutOfRange=y;const R="data_loss";s.DataLoss=R})(Y||(Y={}));function _(s){let t,n=s[0],e=1;for(;e<s.length;){const r=s[e],c=s[e+1];if(e+=2,(r==="optionalAccess"||r==="optionalCall")&&n==null)return;r==="access"||r==="optionalAccess"?(t=n,n=c(n)):(r==="call"||r==="optionalCall")&&(n=c((...a)=>n.call(t,...a)),t=void 0)}return n}function S(s){const t=_([s,"call",e=>e(),"access",e=>e.getClient,"call",e=>e(),"optionalAccess",e=>e.getOptions,"call",e=>e()]);return(_([t,"optionalAccess",e=>e.instrumenter])||"sentry")!=="sentry"}class U{static __initStatic(){this.id="Express"}constructor(t={}){this.name=U.id,this._router=t.router||t.app,this._methods=(Array.isArray(t.methods)?t.methods:[]).concat("use")}setupOnce(t,n){if(!this._router){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("ExpressIntegration is missing an Express instance");return}if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("Express Integration is skipped because of instrumenter configuration.");return}de(this._router,this._methods),_e(this._router)}}U.__initStatic();function C(s,t){const n=s.length;switch(n){case 2:return function(e,r){const c=r.__sentry_transaction;if(c){const a=c.startChild({description:s.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"});r.once("finish",()=>{a.finish()})}return s.call(this,e,r)};case 3:return function(e,r,c){const a=r.__sentry_transaction,o=_([a,"optionalAccess",i=>i.startChild,"call",i=>i({description:s.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);s.call(this,e,r,function(...i){_([o,"optionalAccess",l=>l.finish,"call",l=>l()]),c.call(this,...i)})};case 4:return function(e,r,c,a){const o=c.__sentry_transaction,i=_([o,"optionalAccess",l=>l.startChild,"call",l=>l({description:s.name,op:`middleware.express.${t}`,origin:"auto.middleware.express"})]);s.call(this,e,r,c,function(...l){_([i,"optionalAccess",u=>u.finish,"call",u=>u()]),a.call(this,...l)})};default:throw new Error(`Express middleware takes 2-4 arguments. Got: ${n}`)}}function le(s,t){return s.map(n=>typeof n=="function"?C(n,t):Array.isArray(n)?n.map(e=>typeof e=="function"?C(e,t):e):n)}function ue(s,t){const n=s[t];return s[t]=function(...e){return n.call(this,...le(e,t))},s}function de(s,t=[]){t.forEach(n=>ue(s,n))}function _e(s){const t="settings"in s;t&&s._router===void 0&&s.lazyrouter&&s.lazyrouter();const n=t?s._router:s;if(!n){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.debug("Cannot instrument router for URL Parameterization (did not find a valid router)."),(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.debug("Routing instrumentation is currently only supported in Express 4.");return}const e=Object.getPrototypeOf(n),r=e.process_params;e.process_params=function(a,o,i,l,u){i._reconstructedRoute||(i._reconstructedRoute="");const{layerRoutePath:d,isRegex:g,isArray:p,numExtraSegments:f}=fe(a);(d||g||p)&&(i._hasParameters=!0);let h;d?h=d:h=me(i.originalUrl,i._reconstructedRoute,a.path)||"";const y=h.split("/").filter(b=>b.length>0&&(g||p||!b.includes("*"))).join("/");y&&y.length>0&&(i._reconstructedRoute+=`/${y}${g?"/":""}`);const R=x(N(i.originalUrl||""))+f,M=x(i._reconstructedRoute);if(R===M){i._hasParameters||i._reconstructedRoute!==i.originalUrl&&(i._reconstructedRoute=i.originalUrl?N(i.originalUrl):i.originalUrl);const b=l.__sentry_transaction;if(b&&b.metadata.source!=="custom"){const j=i._reconstructedRoute||"/";b.setName(...ce(i,{path:!0,method:!0,customRoute:j}))}}return r.call(this,a,o,i,l,u)}}const pe=(s,t,n)=>{if(!s||!t||!n||Object.keys(n).length===0||!_([n,"access",l=>l[0],"optionalAccess",l=>l.offset]))return;const e=n.sort((l,u)=>l.offset-u.offset),c=new RegExp(t,`${t.flags}d`).exec(s);if(!c||!c.indices)return;const[,...a]=c.indices;if(a.length!==e.length)return;let o=s,i=0;return a.forEach(([l,u],d)=>{const g=o.substring(0,l-i),p=`:${e[d].name}`,f=o.substring(u-i);o=g+p+f,i=i+(u-l-p.length)}),o};function fe(s){let t=_([s,"access",a=>a.route,"optionalAccess",a=>a.path]);const n=q(t),e=Array.isArray(t);if(!t){const[a]=process.versions.node.split(".").map(Number);a>=16&&(t=pe(s.path,s.regexp,s.keys))}if(!t)return{isRegex:n,isArray:e,numExtraSegments:0};const r=e?Math.max(he(t)-x(s.path||""),0):0;return{layerRoutePath:ge(e,t),isRegex:n,isArray:e,numExtraSegments:r}}function he(s){return s.reduce((t,n)=>t+x(n.toString()),0)}function ge(s,t){return s?t.map(n=>n.toString()).join(","):t&&t.toString()}function me(s,t,n){const e=_([s,"optionalAccess",o=>o.split,"call",o=>o("/"),"access",o=>o.filter,"call",o=>o(i=>!!i)]);let r=0;const c=_([t,"optionalAccess",o=>o.split,"call",o=>o("/"),"access",o=>o.filter,"call",o=>o(i=>!!i),"access",o=>o.length])||0;return _([n,"optionalAccess",o=>o.split,"call",o=>o("/"),"access",o=>o.filter,"call",o=>o(i=>_([e,"optionalAccess",l=>l[c+r]])===i?(r+=1,!0):!1),"access",o=>o.join,"call",o=>o("/")])}class O{static __initStatic(){this.id="Postgres"}constructor(t={}){this.name=O.id,this._usePgNative=!!t.usePgNative,this._module=t.module}loadDependency(){return this._module=this._module||A("pg")}setupOnce(t,n){if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("Postgres Integration is skipped because of instrumenter configuration.");return}const e=this.loadDependency();if(!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Postgres Integration was unable to require `pg` package.");return}const r=this._usePgNative?_([e,"access",c=>c.native,"optionalAccess",c=>c.Client]):e.Client;if(!r){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Postgres Integration was unable to access 'pg-native' bindings.");return}E(r.prototype,"query",function(c){return function(a,o,i){const u=n().getScope().getSpan(),d={"db.system":"postgresql"};try{this.database&&(d["db.name"]=this.database),this.host&&(d["server.address"]=this.host),this.port&&(d["server.port"]=this.port),this.user&&(d["db.user"]=this.user)}catch{}const g=_([u,"optionalAccess",f=>f.startChild,"call",f=>f({description:typeof a=="string"?a:a.text,op:"db",origin:"auto.db.postgres",data:d})]);if(typeof i=="function")return c.call(this,a,o,function(f,h){_([g,"optionalAccess",y=>y.finish,"call",y=>y()]),i(f,h)});if(typeof o=="function")return c.call(this,a,function(f,h){_([g,"optionalAccess",y=>y.finish,"call",y=>y()]),o(f,h)});const p=typeof o<"u"?c.call(this,a,o):c.call(this,a);return D(p)?p.then(f=>(_([g,"optionalAccess",h=>h.finish,"call",h=>h()]),f)):(_([g,"optionalAccess",f=>f.finish,"call",f=>f()]),p)}})}}O.__initStatic();class I{static __initStatic(){this.id="Mysql"}constructor(){this.name=I.id}loadDependency(){return this._module=this._module||A("mysql/lib/Connection.js")}setupOnce(t,n){if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("Mysql Integration is skipped because of instrumenter configuration.");return}const e=this.loadDependency();if(!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Mysql Integration was unable to require `mysql` package.");return}let r;try{e.prototype.connect=new Proxy(e.prototype.connect,{apply(o,i,l){return r||(r=i.config),o.apply(i,l)}})}catch{(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Mysql Integration was unable to instrument `mysql` config.")}function c(){return r?{"server.address":r.host,"server.port":r.port,"db.user":r.user}:{}}function a(o){if(!o||o.endTimestamp)return;const i=c();Object.keys(i).forEach(l=>{o.setData(l,i[l])}),o.finish()}E(e,"createQuery",function(o){return function(i,l,u){const g=n().getScope().getSpan(),p=_([g,"optionalAccess",h=>h.startChild,"call",h=>h({description:typeof i=="string"?i:i.sql,op:"db",origin:"auto.db.mysql",data:{"db.system":"mysql"}})]);if(typeof u=="function")return o.call(this,i,l,function(h,y,R){a(p),u(h,y,R)});if(typeof l=="function")return o.call(this,i,function(h,y,R){a(p),l(h,y,R)});const f=o.call(this,i,l);return f.on("end",()=>{a(p)}),f}})}}I.__initStatic();const ye=["aggregate","bulkWrite","countDocuments","createIndex","createIndexes","deleteMany","deleteOne","distinct","drop","dropIndex","dropIndexes","estimatedDocumentCount","find","findOne","findOneAndDelete","findOneAndReplace","findOneAndUpdate","indexes","indexExists","indexInformation","initializeOrderedBulkOp","insertMany","insertOne","isCapped","mapReduce","options","parallelCollectionScan","rename","replaceOne","stats","updateMany","updateOne"],Ee={bulkWrite:["operations"],countDocuments:["query"],createIndex:["fieldOrSpec"],createIndexes:["indexSpecs"],deleteMany:["filter"],deleteOne:["filter"],distinct:["key","query"],dropIndex:["indexName"],find:["query"],findOne:["query"],findOneAndDelete:["filter"],findOneAndReplace:["filter","replacement"],findOneAndUpdate:["filter","update"],indexExists:["indexes"],insertMany:["docs"],insertOne:["doc"],mapReduce:["map","reduce"],rename:["newName"],replaceOne:["filter","doc"],updateMany:["filter","update"],updateOne:["filter","update"]};function Re(s){return s&&typeof s=="object"&&s.once&&typeof s.once=="function"}class G{static __initStatic(){this.id="Mongo"}constructor(t={}){this.name=G.id,this._operations=Array.isArray(t.operations)?t.operations:ye,this._describeOperations="describeOperations"in t?t.describeOperations:!0,this._useMongoose=!!t.useMongoose}loadDependency(){const t=this._useMongoose?"mongoose":"mongodb";return this._module=this._module||A(t)}setupOnce(t,n){if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("Mongo Integration is skipped because of instrumenter configuration.");return}const e=this.loadDependency();if(!e){const r=this._useMongoose?"mongoose":"mongodb";(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error(`Mongo Integration was unable to require \`${r}\` package.`);return}this._instrumentOperations(e.Collection,this._operations,n)}_instrumentOperations(t,n,e){n.forEach(r=>this._patchOperation(t,r,e))}_patchOperation(t,n,e){if(!(n in t.prototype))return;const r=this._getSpanContextFromOperationArguments.bind(this);E(t.prototype,n,function(c){return function(...a){const o=a[a.length-1],l=e().getScope().getSpan();if(typeof o!="function"||n==="mapReduce"&&a.length===2){const d=_([l,"optionalAccess",p=>p.startChild,"call",p=>p(r(this,n,a))]),g=c.call(this,...a);if(D(g))return g.then(p=>(_([d,"optionalAccess",f=>f.finish,"call",f=>f()]),p));if(Re(g)){const p=g;try{p.once("close",()=>{_([d,"optionalAccess",f=>f.finish,"call",f=>f()])})}catch{_([d,"optionalAccess",h=>h.finish,"call",h=>h()])}return p}else return _([d,"optionalAccess",p=>p.finish,"call",p=>p()]),g}const u=_([l,"optionalAccess",d=>d.startChild,"call",d=>d(r(this,n,a.slice(0,-1)))]);return c.call(this,...a.slice(0,-1),function(d,g){_([u,"optionalAccess",p=>p.finish,"call",p=>p()]),o(d,g)})}})}_getSpanContextFromOperationArguments(t,n,e){const r={"db.system":"mongodb","db.name":t.dbName,"db.operation":n,"db.mongodb.collection":t.collectionName},c={op:"db",origin:"auto.db.mongo",description:n,data:r},a=Ee[n],o=Array.isArray(this._describeOperations)?this._describeOperations.includes(n):this._describeOperations;if(!a||!o)return c;try{if(n==="mapReduce"){const[i,l]=e;r[a[0]]=typeof i=="string"?i:i.name||"<anonymous>",r[a[1]]=typeof l=="string"?l:l.name||"<anonymous>"}else for(let i=0;i<a.length;i++)r[`db.mongodb.${a[i]}`]=JSON.stringify(e[i])}catch{}return c}}G.__initStatic();function Ae(s){return!!s&&!!s.$use}class B{static __initStatic(){this.id="Prisma"}constructor(t={}){if(this.name=B.id,Ae(t.client)&&!t.client._sentryInstrumented){L(t.client,"_sentryInstrumented",!0);const n={};try{const e=t.client._engineConfig;if(e){const{activeProvider:r,clientVersion:c}=e;r&&(n["db.system"]=r),c&&(n["db.prisma.version"]=c)}}catch{}t.client.$use((e,r)=>{if(S(Q))return r(e);const c=e.action,a=e.model;return F({name:a?`${a} ${c}`:c,op:"db.sql.prisma",origin:"auto.db.prisma",data:{...n,"db.operation":c}},()=>r(e))})}else(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.warn("Unsupported Prisma client provided to PrismaIntegration. Provided client:",t.client)}setupOnce(){}}B.__initStatic();class P{static __initStatic(){this.id="GraphQL"}constructor(){this.name=P.id}loadDependency(){return this._module=this._module||A("graphql/execution/execute.js")}setupOnce(t,n){if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("GraphQL Integration is skipped because of instrumenter configuration.");return}const e=this.loadDependency();if(!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("GraphQL Integration was unable to require graphql/execution package.");return}E(e,"execute",function(r){return function(...c){const a=n().getScope(),o=a.getSpan(),i=_([o,"optionalAccess",u=>u.startChild,"call",u=>u({description:"execute",op:"graphql.execute",origin:"auto.graphql.graphql"})]);_([a,"optionalAccess",u=>u.setSpan,"call",u=>u(i)]);const l=r.call(this,...c);return D(l)?l.then(u=>(_([i,"optionalAccess",d=>d.finish,"call",d=>d()]),_([a,"optionalAccess",d=>d.setSpan,"call",d=>d(o)]),u)):(_([i,"optionalAccess",u=>u.finish,"call",u=>u()]),_([a,"optionalAccess",u=>u.setSpan,"call",u=>u(o)]),l)}})}}P.__initStatic();class w{static __initStatic(){this.id="Apollo"}constructor(t={useNestjs:!1}){this.name=w.id,this._useNest=!!t.useNestjs}loadDependency(){return this._useNest?this._module=this._module||A("@nestjs/graphql"):this._module=this._module||A("apollo-server-core"),this._module}setupOnce(t,n){if(S(n)){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.log("Apollo Integration is skipped because of instrumenter configuration.");return}if(this._useNest){const e=this.loadDependency();if(!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Apollo-NestJS Integration was unable to require @nestjs/graphql package.");return}E(e.GraphQLFactory.prototype,"mergeWithSchema",function(r){return function(...c){return E(this.resolversExplorerService,"explore",function(a){return function(){const o=v(a.call(this));return k(o,n)}}),r.call(this,...c)}})}else{const e=this.loadDependency();if(!e){(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&m.error("Apollo Integration was unable to require apollo-server-core package.");return}E(e.ApolloServerBase.prototype,"constructSchema",function(r){return function(){if(!this.config.resolvers)return(typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__)&&(this.config.schema?(m.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `schema` property.If you are using NestJS with Apollo, please use `Sentry.Integrations.Apollo({ useNestjs: true })` instead."),m.warn()):this.config.modules&&m.warn("Apollo integration is not able to trace `ApolloServer` instances constructed via `modules` property."),m.error("Skipping tracing as no resolvers found on the `ApolloServer` instance.")),r.call(this);const c=v(this.config.resolvers);return this.config.resolvers=k(c,n),r.call(this)}})}}}w.__initStatic();function k(s,t){return s.map(n=>(Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(r=>{typeof n[e][r]=="function"&&Se(n,e,r,t)})}),n))}function Se(s,t,n,e){E(s[t],n,function(r){return function(...c){const o=e().getScope().getSpan(),i=_([o,"optionalAccess",u=>u.startChild,"call",u=>u({description:`${t}.${n}`,op:"graphql.resolve",origin:"auto.graphql.apollo"})]),l=r.call(this,...c);return D(l)?l.then(u=>(_([i,"optionalAccess",d=>d.finish,"call",d=>d()]),u)):(_([i,"optionalAccess",u=>u.finish,"call",u=>u()]),l)}})}function be(){const s=J();if(!s.__SENTRY__)return;const t={mongodb(){const e=T(module,"./node/integrations/mongo");return new e.Mongo},mongoose(){const e=T(module,"./node/integrations/mongo");return new e.Mongo},mysql(){const e=T(module,"./node/integrations/mysql");return new e.Mysql},pg(){const e=T(module,"./node/integrations/postgres");return new e.Postgres}},n=Object.keys(t).filter(e=>!!A(e)).map(e=>{try{return t[e]()}catch{return}}).filter(e=>e);n.length>0&&(s.__SENTRY__.integrations=[...s.__SENTRY__.integrations||[],...n])}function $(){W(),z()&&be()}const Te=V,xe=$,De=X,Ue=K,Oe=Z,Ie=H,Ge=ee,Be=te,Pe=ne,we=se,Ye=N,ve=ie,Ce=oe,ke=re,$e=ae,Me=Y,je={BrowserTracing:Te,Apollo:w,Express:U,GraphQL:P,Mongo:G,Mysql:I,Postgres:O,Prisma:B};(typeof __SENTRY_TRACING__>"u"||__SENTRY_TRACING__)&&$();export{Be as BROWSER_TRACING_INTEGRATION_ID,Te as BrowserTracing,Ce as IdleTransaction,je as Integrations,Ge as Span,Me as SpanStatus,ve as TRACEPARENT_REGEXP,Ie as Transaction,xe as addExtensionMethods,Pe as defaultRequestInstrumentationOptions,Ue as extractTraceparentData,De as getActiveTransaction,we as hasTracingEnabled,ke as instrumentOutgoingRequests,Oe as spanStatusfromHttpCode,$e as startIdleTransaction,Ye as stripUrlQueryAndFragment};
