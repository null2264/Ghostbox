import{u as Y,d as le,t as oe,bb as se,g as re,q as de,r as F,ax as j,a as e,bG as ne,R as W,az as q,bH as k,F as r,bI as x,f3 as fe,b$ as ue,aj as ce,ak as y,al as M,bK as he,ae as G,X as ve,f4 as pe,f5 as _e,o as me,bN as L,H as ge,f6 as be,f7 as we,br as K,_ as E}from"../index-c29ef263.js";import"./es.array.splice-376ca623.js";import{S as ye}from"./streamfield-72f89e5b.js";import{u as z}from"./useImageField-fc94c170.js";import{H as Me,A as Ce}from"./header-picker-c1c7ad49.js";import"./photo-plus-14444f2c.js";function X(u,a){var t=Object.keys(u);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(u);a&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(u,c).enumerable})),t.push.apply(t,i)}return t}function g(u){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?X(Object(t),!0).forEach(function(i){E(u,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(t)):X(Object(t)).forEach(function(i){Object.defineProperty(u,i,Object.getOwnPropertyDescriptor(t,i))})}return u}var ke=function(a){return a&&pe(a)?void 0:a},xe=function(a){return a&&_e(a)?void 0:a},Pe=function(a){var t=a.pleroma;return!!(t!=null&&t.hide_followers&&(t!=null&&t.hide_follows)&&(t!=null&&t.hide_followers_count)&&(t!=null&&t.hide_follows_count))},v=me({heading:{id:"column.edit_profile",defaultMessage:"Edit profile"},header:{id:"edit_profile.header",defaultMessage:"Edit Profile"},metaFieldLabel:{id:"edit_profile.fields.meta_fields.label_placeholder",defaultMessage:"Label"},metaFieldContent:{id:"edit_profile.fields.meta_fields.content_placeholder",defaultMessage:"Content"},success:{id:"edit_profile.success",defaultMessage:"Profile saved!"},error:{id:"edit_profile.error",defaultMessage:"Profile update failed"},bioPlaceholder:{id:"edit_profile.fields.bio_placeholder",defaultMessage:"Tell us about yourself."},displayNamePlaceholder:{id:"edit_profile.fields.display_name_placeholder",defaultMessage:"Name"},websitePlaceholder:{id:"edit_profile.fields.website_placeholder",defaultMessage:"Display a Link"},locationPlaceholder:{id:"edit_profile.fields.location_placeholder",defaultMessage:"Location"},cancel:{id:"common.cancel",defaultMessage:"Cancel"}}),Se=function(a){var t,i,c,_,p,d,n,b,m=Pe(a);return{discoverable:a.discoverable,bot:a.bot,display_name:a.display_name,note:(t=(i=a.source)===null||i===void 0?void 0:i.note)!==null&&t!==void 0?t:"",locked:a.locked,fields_attributes:L((c=(_=a.source)===null||_===void 0?void 0:_.fields)!==null&&c!==void 0?c:[]),stranger_notifications:((p=a.pleroma)===null||p===void 0||(p=p.notification_settings)===null||p===void 0?void 0:p.block_from_strangers)===!0,accepts_email_list:((d=a.pleroma)===null||d===void 0?void 0:d.accepts_email_list)===!0,hide_followers:m,hide_follows:m,hide_followers_count:m,hide_follows_count:m,website:a.website,location:a.location,birthday:(n=(b=a.pleroma)===null||b===void 0?void 0:b.birthday)!==null&&n!==void 0?n:void 0}},Fe=function(a){var t=a.value,i=a.onChange,c=Y(),_=function(d){return function(n){i(g(g({},t),{},E({},d,n.currentTarget.value)))}};return e(ge,{space:2,grow:!0},void 0,e(x,{type:"text",outerClassName:"w-2/5 grow",value:t.name,onChange:_("name"),placeholder:c.formatMessage(v.metaFieldLabel)}),e(x,{type:"text",outerClassName:"w-3/5 grow",value:t.value,onChange:_("value"),placeholder:c.formatMessage(v.metaFieldContent)}))},Le=function(){var a,t,i=Y(),c=le(),_=oe(),p=se(),d=p.account,n=re(),b=_.pleroma.metadata.fields_limits.max_fields,m=(a=(t=de(function(o){return o.instance.configuration.media_attachments.supported_mime_types}))===null||t===void 0?void 0:t.filter(function(o){return o.startsWith("image/")}).join(","))!==null&&a!==void 0?a:"",J=F.useState(!1),H=j(J,2),O=H[0],D=H[1],Q=F.useState({}),I=j(Q,2),f=I[0],A=I[1],U=F.useState(!1),R=j(U,2),$=R[0],B=R[1],T=z({maxPixels:400*400,preview:ke(d==null?void 0:d.avatar)}),N=z({maxPixels:1920*1080,preview:xe(d==null?void 0:d.header)});F.useEffect(function(){if(d){var o,l=Se(d),s=((o=d.pleroma)===null||o===void 0||(o=o.notification_settings)===null||o===void 0?void 0:o.block_from_strangers)===!0;A(l),B(s)}},[d==null?void 0:d.id]);var w=function(l,s){A(function(h){return g(g({},h),{},E({},l,s))})},V=function(l){var s,h=[],C=g({},f);((s=C.fields_attributes)===null||s===void 0?void 0:s.length)===0&&(C.fields_attributes=[{name:"",value:""}]),N.file!==void 0&&(C.header=N.file||""),T.file!==void 0&&(C.avatar=T.file||""),h.push(c(be(C,!0))),n.muteStrangers&&h.push(c(we({block_from_strangers:$})).catch(console.error)),D(!0),Promise.all(h).then(function(){D(!1),K.success(i.formatMessage(v.success))}).catch(function(){D(!1),K.error(i.formatMessage(v.error))}),l.preventDefault()},P=function(l){return function(s){w(l,s.target.checked)}},S=function(l){return function(s){w(l,s.target.value)}},Z=function(l){w("birthday",l)},ee=function(l){var s=l.target.checked;A(function(h){return g(g({},h),{},{hide_followers:s,hide_follows:s,hide_followers_count:s,hide_follows_count:s})})},ae=function(l){w("fields_attributes",l)},te=function(){var l=f.fields_attributes||[],s=[].concat(L(l),[{name:"",value:""}]);w("fields_attributes",s)},ie=function(l){var s=f.fields_attributes||[],h=L(s);h.splice(l,1),w("fields_attributes",h)};return e(ve,{label:i.formatMessage(v.header)},void 0,e(ne,{onSubmit:V},void 0,e("div",{className:"relative mb-12 flex"},void 0,W.createElement(Me,q({accept:m,disabled:O},N)),W.createElement(Ce,q({className:"!sm:left-6 !left-4 !translate-x-0",accept:m,disabled:O},T))),e(k,{labelText:e(r,{id:"edit_profile.fields.display_name_label",defaultMessage:"Display name"})},void 0,e(x,{type:"text",value:f.display_name,onChange:S("display_name"),placeholder:i.formatMessage(v.displayNamePlaceholder)})),n.birthdays&&e(k,{labelText:e(r,{id:"edit_profile.fields.birthday_label",defaultMessage:"Birthday"})},void 0,e(fe,{value:f.birthday,onChange:Z})),n.accountLocation&&e(k,{labelText:e(r,{id:"edit_profile.fields.location_label",defaultMessage:"Location"})},void 0,e(x,{type:"text",value:f.location,onChange:S("location"),placeholder:i.formatMessage(v.locationPlaceholder)})),n.accountWebsite&&e(k,{labelText:e(r,{id:"edit_profile.fields.website_label",defaultMessage:"Website"})},void 0,e(x,{type:"text",value:f.website,onChange:S("website"),placeholder:i.formatMessage(v.websitePlaceholder)})),e(k,{labelText:e(r,{id:"edit_profile.fields.bio_label",defaultMessage:"Bio"})},void 0,e(ue,{value:f.note,onChange:S("note"),autoComplete:"off",placeholder:i.formatMessage(v.bioPlaceholder)})),e(ce,{},void 0,n.followRequests&&e(y,{label:e(r,{id:"edit_profile.fields.locked_label",defaultMessage:"Lock account"}),hint:e(r,{id:"edit_profile.hints.locked",defaultMessage:"Requires you to manually approve followers"})},void 0,e(M,{checked:f.locked,onChange:P("locked")})),n.hideNetwork&&e(y,{label:e(r,{id:"edit_profile.fields.hide_network_label",defaultMessage:"Hide network"}),hint:e(r,{id:"edit_profile.hints.hide_network",defaultMessage:"Who you follow and who follows you will not be shown on your profile"})},void 0,e(M,{checked:d?f.hide_followers&&f.hide_follows&&f.hide_followers_count&&f.hide_follows_count:!1,onChange:ee})),n.bots&&e(y,{label:e(r,{id:"edit_profile.fields.bot_label",defaultMessage:"This is a bot account"}),hint:e(r,{id:"edit_profile.hints.bot",defaultMessage:"This account mainly performs automated actions and might not be monitored"})},void 0,e(M,{checked:f.bot,onChange:P("bot")})),n.muteStrangers&&e(y,{label:e(r,{id:"edit_profile.fields.stranger_notifications_label",defaultMessage:"Block notifications from strangers"}),hint:e(r,{id:"edit_profile.hints.stranger_notifications",defaultMessage:"Only show notifications from people you follow"})},void 0,e(M,{checked:$,onChange:function(l){return B(l.target.checked)}})),n.profileDirectory&&e(y,{label:e(r,{id:"edit_profile.fields.discoverable_label",defaultMessage:"Allow account discovery"}),hint:e(r,{id:"edit_profile.hints.discoverable",defaultMessage:"Display account in profile directory and allow indexing by external services"})},void 0,e(M,{checked:f.discoverable,onChange:P("discoverable")})),n.emailList&&e(y,{label:e(r,{id:"edit_profile.fields.accepts_email_list_label",defaultMessage:"Subscribe to newsletter"}),hint:e(r,{id:"edit_profile.hints.accepts_email_list",defaultMessage:"Opt-in to news and marketing updates."})},void 0,e(M,{checked:f.accepts_email_list,onChange:P("accepts_email_list")}))),n.profileFields&&e(ye,{label:e(r,{id:"edit_profile.fields.meta_fields_label",defaultMessage:"Profile fields"}),hint:e(r,{id:"edit_profile.hints.meta_fields",defaultMessage:"You can have up to {count, plural, one {# custom field} other {# custom fields}} displayed on your profile.",values:{count:b}}),values:f.fields_attributes||[],onChange:ae,onAddItem:te,onRemoveItem:ie,component:Fe,maxItems:b}),e(he,{},void 0,e(G,{to:"/settings",theme:"tertiary"},void 0,i.formatMessage(v.cancel)),e(G,{theme:"primary",type:"submit",disabled:O},void 0,e(r,{id:"edit_profile.save",defaultMessage:"Save"})))))};export{Le as default};
