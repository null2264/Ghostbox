import{u as w,gG as ie,q as y,a as e,T as de,o as C,d as R,b6 as ce,a3 as _,y as M,H as L,gH as ue,gI as le,r as A,ax as V,gJ as ve,fA as Q,gK as me,gL as pe,L as E,R as x,aj as $,ak as p,t as ee,F as d,ep as ge,br as ae,gM as D,g as fe,bb as te,gN as he,cy as F,aK as H,gO as P,A as be,ch as _e,bT as Me,gP as we,cP as se,J as Ce,aL as ne,gQ as Re,gR as xe,gS as z,c8 as ye,ae as Ae,gT as ke,ci as Se,cj as Ie,gU as Ne,X as De,f$ as Ue,g0 as O}from"../index-3e9a931c.js";import{S as oe}from"./scrollable-list-698e488f.js";import{A as Le}from"./authorize-reject-buttons-b7e5f171.js";import{v as B}from"./download-ac53125a.js";import{d as G}from"./download-2e3dfb39.js";import{v as re}from"./dots-vertical-68cbc8e2.js";import{A as Te}from"./accordion-5f831470.js";import"./index-489b99b9.js";import"./load-more-eb54daa4.js";var K=C({dashboard:{id:"admin_nav.dashboard",defaultMessage:"Dashboard"},reports:{id:"admin_nav.reports",defaultMessage:"Reports"},waitlist:{id:"admin_nav.awaiting_approval",defaultMessage:"Waitlist"}}),qe=function(){var a=w(),t=ie(),s=y(function(n){return n.admin.awaitingApproval.count()}),r=y(function(n){return n.admin.openReports.count()}),o=[{name:"/ghostbox/admin",text:a.formatMessage(K.dashboard),to:"/ghostbox/admin"},{name:"/ghostbox/admin/reports",text:a.formatMessage(K.reports),to:"/ghostbox/admin/reports",count:r},{name:"/ghostbox/admin/approval",text:a.formatMessage(K.waitlist),to:"/ghostbox/admin/approval",count:s}];return e(de,{items:o,activeItem:t.path})},Pe=function(a){var t=a.accountId,s=R(),r=ce(t),o=r.account,n=y(function(i){return i.admin.users.get(t)});if(!o)return null;var c=function(){return s(ue([o.id]))},l=function(){return s(le([o.id]))};return e(L,{space:4,justifyContent:"between"},void 0,e(_,{space:1},void 0,e(M,{weight:"semibold"},void 0,"@",o.acct),e(M,{tag:"blockquote",size:"sm"},void 0,(n==null?void 0:n.invite_request)||"")),e(_,{justifyContent:"center"},void 0,e(Le,{onAuthorize:c,onReject:l,countdown:3e3})))},Ee=C({heading:{id:"column.admin.awaiting_approval",defaultMessage:"Awaiting Approval"},emptyMessage:{id:"admin.awaiting_approval.empty_message",defaultMessage:"There is nobody waiting for approval. When a new user signs up, you can review them here."}}),$e=function(){var a=w(),t=R(),s=y(function(i){return i.admin.awaitingApproval}),r=A.useState(!0),o=V(r,2),n=o[0],c=o[1];A.useEffect(function(){t(ve(["local","need_approval"])).then(function(){return c(!1)}).catch(function(){})},[]);var l=n&&s.count()===0;return e(oe,{isLoading:n,showLoading:l,scrollKey:"awaiting-approval",emptyMessage:a.formatMessage(Ee.emptyMessage),className:"divide-y divide-solid divide-gray-200 dark:divide-gray-800"},void 0,s.map(function(i){return e("div",{className:"px-5 py-4"},i,e(Pe,{accountId:i}))}))};const je=()=>(u,a)=>Q(a).get("/api/v1/pleroma/admin/email_list/subscribers.csv"),Fe=()=>(u,a)=>Q(a).get("/api/v1/pleroma/admin/email_list/unsubscribers.csv"),He=()=>(u,a)=>Q(a).get("/api/v1/pleroma/admin/email_list/combined.csv");var U=function(a){var t=a.count,s=a.label,r=a.to,o=r===void 0?"#":r,n=a.percent,c=n===void 0?!1:n;return me(t)?e(E,{className:"flex cursor-pointer flex-col items-center space-y-2 rounded bg-gray-200 p-4 transition-transform hover:-translate-y-1 dark:bg-gray-800",to:o},void 0,e(M,{align:"center",size:"2xl",weight:"medium"},void 0,e(pe,{value:t,style:c?"unit":void 0,unit:c?"percent":void 0})),e(M,{align:"center"},void 0,s)):null},ze=function(a){var t=a.children;return e("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2 lg:grid-cols-3"},void 0,t)},Oe=function(a){var t=a.onChange,s=a.children,r=x.Children.map(s,function(o){return x.cloneElement(o,{onChange:t})});return e($,{},void 0,r)},W=function(a){var t=a.label,s=a.hint,r=a.checked,o=r===void 0?!1:r,n=a.onChange,c=a.value;return e(p,{label:t,hint:s},void 0,e("input",{type:"radio",checked:o,onChange:n,value:c,className:"h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-500"}))},Be=C({saved:{id:"admin.dashboard.settings_saved",defaultMessage:"Settings saved!"}}),Ge=function(a){var t={open:[D(":registrations_open",!0),D(":account_approval_required",!1)],approval:[D(":registrations_open",!0),D(":account_approval_required",!0)],closed:[D(":registrations_open",!1)]};return[{group:":pleroma",key:":instance",value:t[a]}]},Ke=function(a){return a.approval_required&&a.registrations?"approval":a.registrations?"open":"closed"},We=function(){var a=w(),t=R(),s=ee(),r=Ke(s),o=function(c){var l=Ge(c.target.value);t(ge(l)).then(function(){ae.success(a.formatMessage(Be.saved))}).catch(function(){})};return e(Oe,{onChange:o},void 0,e(W,{label:e(d,{id:"admin.dashboard.registration_mode.open_label",defaultMessage:"Open"}),hint:e(d,{id:"admin.dashboard.registration_mode.open_hint",defaultMessage:"Anyone can join."}),checked:r==="open",value:"open"}),e(W,{label:e(d,{id:"admin.dashboard.registration_mode.approval_label",defaultMessage:"Approval Required"}),hint:e(d,{id:"admin.dashboard.registration_mode.approval_hint",defaultMessage:"Users can sign up, but their account only gets activated when an admin approves it."}),checked:r==="approval",value:"approval"}),e(W,{label:e(d,{id:"admin.dashboard.registration_mode.closed_label",defaultMessage:"Closed"}),hint:e(d,{id:"admin.dashboard.registration_mode.closed_hint",defaultMessage:"Nobody can sign up. You can still invite people."}),checked:r==="closed",value:"closed"}))},Je=function(){var a=R(),t=ee(),s=fe(),r=te(),o=r.account,n=function(g){a(je()).then(function(f){var h=f.data;G(h,"subscribers.csv")}).catch(function(){}),g.preventDefault()},c=function(g){a(Fe()).then(function(f){var h=f.data;G(h,"unsubscribers.csv")}).catch(function(){}),g.preventDefault()},l=function(g){a(He()).then(function(f){var h=f.data;G(h,"combined.csv")}).catch(function(){}),g.preventDefault()},i=he(t.version),k=t.stats.user_count,T=t.stats.status_count,v=t.stats.domain_count,S=t.pleroma.stats.mau,I=k&&S?Math.round(S/k*100):void 0;return o?e(_,{space:6,className:"mt-4"},void 0,e(ze,{},void 0,e(U,{count:S,label:e(d,{id:"admin.dashcounters.mau_label",defaultMessage:"monthly active users"})}),e(U,{to:"/ghostbox/admin/users",count:k,label:e(d,{id:"admin.dashcounters.user_count_label",defaultMessage:"total users"})}),e(U,{count:I,label:e(d,{id:"admin.dashcounters.retention_label",defaultMessage:"user retention"}),percent:!0}),e(U,{to:"/timeline/local",count:T,label:e(d,{id:"admin.dashcounters.status_count_label",defaultMessage:"posts"})}),e(U,{count:v,label:e(d,{id:"admin.dashcounters.domain_count_label",defaultMessage:"peers"})})),e($,{},void 0,o.admin&&e(p,{to:"/ghostbox/admin/config",label:e(d,{id:"navigation_bar.soapbox_config",defaultMessage:"Soapbox config"})}),e(p,{to:"/ghostbox/admin/log",label:e(d,{id:"column.admin.moderation_log",defaultMessage:"Moderation Log"})}),s.announcements&&e(p,{to:"/ghostbox/admin/announcements",label:e(d,{id:"column.admin.announcements",defaultMessage:"Announcements"})})),o.admin&&x.createElement(x.Fragment,null,e(F,{title:e(d,{id:"admin.dashboard.registration_mode_label",defaultMessage:"Registrations"})}),e(We,{})),e(F,{title:e(d,{id:"admin.dashwidgets.software_header",defaultMessage:"Software"})}),e($,{},void 0,e(p,{label:e(d,{id:"admin.software.frontend",defaultMessage:"Frontend"})},void 0,e("a",{href:"".concat(P.url,"/tree/").concat(P.ref),className:"flex items-center space-x-1 truncate",target:"_blank"},void 0,e("span",{},void 0,P.displayName," ",P.version),e(be,{className:"h-4 w-4",src:_e}))),e(p,{label:e(d,{id:"admin.software.backend",defaultMessage:"Backend"})},void 0,e("span",{},void 0,i.software+(i.build?"+".concat(i.build):"")," ",i.version))),s.emailList&&o.admin&&x.createElement(x.Fragment,null,e(F,{title:e(d,{id:"admin.dashwidgets.email_list_header",defaultMessage:"Email list"})}),e($,{},void 0,e(p,{label:"subscribers.csv"},void 0,e(H,{src:B,onClick:n,iconClassName:"h-5 w-5"})),e(p,{label:"unsubscribers.csv"},void 0,e(H,{src:B,onClick:c,iconClassName:"h-5 w-5"})),e(p,{label:"combined.csv"},void 0,e(H,{src:B,onClick:l,iconClassName:"h-5 w-5"}))))):null};const Ve="/packs/assets/hourglass-empty-0fb26cd3.svg";var Z=C({viewStatus:{id:"admin.reports.actions.view_status",defaultMessage:"View post"},deleteStatus:{id:"admin.statuses.actions.delete_status",defaultMessage:"Delete post"}}),Qe=function(a){var t=a.status,s=w(),r=R(),o=function(){r(Re(s,t.id))},n=function(){var i=t.getIn(["account","acct"]);return[{text:s.formatMessage(Z.viewStatus,{acct:"@".concat(i)}),to:"/@".concat(i,"/posts/").concat(t.id),icon:Ce},{text:s.formatMessage(Z.deleteStatus,{acct:"@".concat(i)}),action:o,icon:ne,destructive:!0}]},c=n();return e(L,{space:2,alignItems:"start"},void 0,e(_,{space:2,className:"overflow-hidden",grow:!0},void 0,e(Me,{status:t}),e(we,{status:t})),e("div",{className:"flex-none"},void 0,e(se,{items:c,src:re})))},J=C({reportClosed:{id:"admin.reports.report_closed_message",defaultMessage:"Report on @{name} was closed"},deactivateUser:{id:"admin.users.actions.deactivate_user",defaultMessage:"Deactivate @{name}"},deleteUser:{id:"admin.users.actions.delete_user",defaultMessage:"Delete @{name}"}}),Xe=function(a){var t=a.id,s=w(),r=R(),o=A.useCallback(xe(),[]),n=y(function(m){return o(m,t)}),c=A.useState(!1),l=V(c,2),i=l[0],k=l[1];if(!n)return null;var T=n.account,v=n.target_account,S=function(){return[{text:s.formatMessage(J.deactivateUser,{name:v.username}),action:q,icon:Ve},{text:s.formatMessage(J.deleteUser,{name:v.username}),action:g,icon:ne,destructive:!0}]},I=function(){r(ke([n.id])).then(function(){var b=s.formatMessage(J.reportClosed,{name:v.username});ae.success(b)}).catch(function(){})},q=function(){var b=v.id;r(Se(s,b,function(){return I()}))},g=function(){var b=v.id;r(Ie(s,b,function(){return I()}))},f=function(b){k(b)},h=S(),X=n.statuses,Y=X.count(),N=v.acct,j=T.acct;return e(L,{space:3,className:"p-3"},n.id,e(z,{accountId:v.id,inline:!0},void 0,e(E,{to:"/@".concat(N),title:N},void 0,e(ye,{src:v.avatar,size:32,className:"overflow-hidden"}))),e(_,{space:3,className:"overflow-hidden",grow:!0},void 0,e(M,{tag:"h4",weight:"bold"},void 0,e(d,{id:"admin.reports.report_title",defaultMessage:"Report on {acct}",values:{acct:e(z,{accountId:v.id,inline:!0},void 0,e(E,{to:"/@".concat(N),title:N},void 0,"@",N))}})),Y>0&&e(Te,{headline:"Reported posts (".concat(Y,")"),expanded:i,onToggle:f},void 0,e(_,{space:4},void 0,X.map(function(m){return e(Qe,{report:n,status:m},m.id)}))),e(_,{},void 0,(n.comment||"").length>0&&e(M,{tag:"blockquote",dangerouslySetInnerHTML:{__html:n.comment}}),e(L,{space:1},void 0,e(M,{theme:"muted",tag:"span"},void 0,"—"),e(z,{accountId:T.id,inline:!0},void 0,e(E,{to:"/@".concat(j),title:j,className:"text-primary-600 hover:underline dark:text-accent-blue"},void 0,"@",j))))),e(L,{space:2,alignItems:"start",className:"flex-none"},void 0,e(Ae,{onClick:I},void 0,e(d,{id:"admin.reports.actions.close",defaultMessage:"Close"})),e(se,{items:h,src:re})))},Ye=C({heading:{id:"column.admin.reports",defaultMessage:"Reports"},modlog:{id:"column.admin.reports.menu.moderation_log",defaultMessage:"Moderation Log"},emptyMessage:{id:"admin.reports.empty_message",defaultMessage:"There are no open reports. If a user gets reported, they will show up here."}}),Ze=function(){var a=w(),t=R(),s=A.useState(!0),r=V(s,2),o=r[0],n=r[1],c=y(function(i){return i.admin.openReports.toList()});A.useEffect(function(){t(Ne()).then(function(){return n(!1)}).catch(function(){})},[]);var l=o&&c.count()===0;return e(oe,{isLoading:o,showLoading:l,scrollKey:"admin-reports",emptyMessage:a.formatMessage(Ye.emptyMessage),className:"divide-y divide-solid divide-gray-200 dark:divide-gray-800"},void 0,c.map(function(i){return i&&e(Xe,{id:i},i)}))},ea=C({heading:{id:"column.admin.dashboard",defaultMessage:"Dashboard"}}),ua=function(){var a=w(),t=te(),s=t.account;return s?e(De,{label:a.formatMessage(ea.heading),withHeader:!1},void 0,e(qe,{}),e(Ue,{},void 0,e(O,{path:"/ghostbox/admin",exact:!0,component:Je}),e(O,{path:"/ghostbox/admin/reports",exact:!0,component:Ze}),e(O,{path:"/ghostbox/admin/approval",exact:!0,component:$e}))):null};export{ua as default};
