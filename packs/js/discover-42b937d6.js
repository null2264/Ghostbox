import{bl as Z,g as $,bm as ee,bn as te,bo as ae,kq as re,kr as se,ax as x,r as w,a as e,R as b,H as y,A as C,kk as ie,kj as oe,a3 as f,y as h,eX as M,eY as ne,F as p,gv as F,ks as k,bb as V,aB as W,W as ue,az as A,aw as le,u as ce,aK as de,e1 as ge,e0 as he,bI as ve,a6 as pe,o as me}from"../index-191ddf5f.js";import{u as fe}from"./usePopularGroups-5dcc2297.js";import{G as I}from"./layout-list-49db18b7.js";import{u as be,T as Se}from"./tag-list-item-99f43d7e.js";import{u as we}from"./useDebounce-a4024210.js";import{P as R}from"./placeholder-group-search-9b1447d5.js";import{V as H,a as ye}from"./index-7e893778.js";import{G as xe}from"./group-list-item-5701e7d6.js";import{G as j,L as _e}from"./layout-buttons-86cc2698.js";import{u as ke}from"./useSuggestedGroups-b02b7cef.js";import{T as Ce,a as Ne}from"./tab-bar-21e9f157.js";import"./group-header-image-58c0d60d.js";function Pe(s){const t=Z(),a=$(),{entities:r,...i}=ee([ae.GROUPS,"discover","search",s],()=>t.get("/api/v1/groups/search",{params:{q:s}}),{enabled:a.groupsDiscovery&&!!s,schema:te}),{relationships:d}=re(["discover","search",s],r.map(u=>u.id)),g=r.map(u=>({...u,relationship:d[u.id]||null}));return{...i,groups:g}}var O=function(t){var a=t.children,r=t.controlsHeight,i=t.isDisabled,d=t.itemCount,g=t.itemWidth,u=se(),n=x(u,3),l=n[0],S=n[1],m=n[2].width,v=m||(l==null?void 0:l.clientWidth),o=w.useState(0),c=x(o,2),_=c[0],B=c[1],U=w.useState(1),T=x(U,2),N=T[0],z=T[1],P=Math.ceil(d/_),G=v/Math.floor(v/g),Y=N<P&&P>1,J=N>1&&P>1,K=function(){return z(function(E){return E+1})},X=function(){return z(function(E){return E-1})},Q=function(){return typeof a=="function"?a({width:G||"auto"}):a};return w.useEffect(function(){v&&B(Math.round(v/G))},[v,G]),e(y,{alignItems:"stretch"},void 0,e("div",{className:"z-10 flex w-5 items-center justify-center self-stretch rounded-l-xl bg-white dark:bg-primary-900",style:{height:r||"auto"}},void 0,e("button",{"data-testid":"prev-page",onClick:X,className:"flex h-full w-7 items-center justify-center transition-opacity duration-500 disabled:opacity-25",disabled:!J||i},void 0,e(C,{src:ie,className:"h-5 w-5 text-black dark:text-white"}))),e("div",{className:"relative w-full overflow-hidden"},void 0,b.createElement(y,{alignItems:"center",style:{transform:"translateX(-".concat((N-1)*100,"%)")},className:"transition-all duration-500 ease-out",ref:S},Q())),e("div",{className:"z-10 flex w-5 items-center justify-center self-stretch rounded-r-xl bg-white dark:bg-primary-900",style:{height:r||"auto"}},void 0,e("button",{"data-testid":"next-page",onClick:K,className:"flex h-full w-7 items-center justify-center transition-opacity duration-500 disabled:opacity-25",disabled:!Y||i},void 0,e(C,{src:oe,className:"h-5 w-5 text-black dark:text-white"}))))},q=function(){var t=ne(12,20);return e(f,{space:2,className:"animate-pulse"},void 0,e(f,{className:"aspect-h-7 aspect-w-10 h-full w-full overflow-hidden rounded-lg"},void 0,e("div",{className:"absolute inset-0 rounded-t-lg bg-gray-300 object-cover dark:bg-gray-800"}),e(f,{justifyContent:"end",className:"z-10 p-4 text-gray-900 dark:text-gray-100",space:3},void 0,e("div",{className:"h-11 w-11 rounded-full bg-gray-500 dark:bg-gray-700 dark:ring-primary-900"}),e(f,{space:1,className:"text-gray-500 dark:text-gray-700"},void 0,e(h,{theme:"inherit",weight:"bold",truncate:!0},void 0,M(t)),e(y,{space:3,wrap:!0},void 0,e(h,{tag:"span",theme:"inherit"},void 0,M(6)),e(h,{tag:"span",theme:"inherit"},void 0,M(6)))))),e("div",{className:"h-10 w-full rounded-full bg-gray-300 dark:bg-gray-800"}))},Ge=function(){var t=fe(),a=t.groups,r=t.isFetching,i=t.isFetched,d=t.isError,g=i&&a.length===0||d,u=w.useState(null),n=x(u,2),l=n[0],S=n[1];return e(f,{space:4,"data-testid":"popular-groups"},void 0,e(y,{alignItems:"center",justifyContent:"between"},void 0,e(h,{size:"xl",weight:"bold"},void 0,e(p,{id:"groups.discover.popular.title",defaultMessage:"Popular Groups"})),e(F,{to:"/groups/popular"},void 0,e(h,{tag:"span",weight:"medium",size:"sm",theme:"inherit"},void 0,e(p,{id:"groups.discover.popular.show_more",defaultMessage:"Show More"})))),g?e(h,{theme:"muted"},void 0,e(p,{id:"groups.discover.popular.empty",defaultMessage:"Unable to fetch popular groups at this time. Please check back later."})):e(O,{itemWidth:250,itemCount:a.length,controlsHeight:l==null?void 0:l.clientHeight,isDisabled:r},void 0,function(m){var v=m.width;return b.createElement(b.Fragment,null,r?new Array(4).fill(0).map(function(o,c){return e("div",{className:"relative flex shrink-0 flex-col space-y-2 px-1",style:{width:v||"auto"}},c,e(q,{}))}):a.map(function(o){return b.createElement(I,{key:o.id,group:o,width:v,ref:S})}))}))},Ee=function(){var t=be(),a=t.tags,r=t.isFetched,i=t.isError,d=r&&a.length===0||i;return e(f,{space:4,"data-testid":"popular-tags"},void 0,e(y,{alignItems:"center",justifyContent:"between"},void 0,e(h,{size:"xl",weight:"bold"},void 0,e(p,{id:"groups.discover.tags.title",defaultMessage:"Browse Topics"})),e(F,{to:"/groups/tags"},void 0,e(h,{tag:"span",weight:"medium",size:"sm",theme:"inherit"},void 0,e(p,{id:"groups.discover.tags.show_more",defaultMessage:"Show More"})))),d?e(h,{theme:"muted"},void 0,e(p,{id:"groups.discover.tags.empty",defaultMessage:"Unable to fetch popular topics at this time. Please check back later."})):e(f,{space:4},void 0,a.slice(0,10).map(function(g){return e(Se,{tag:g},g.id)})))};const Me="soapbox:recent-group-searches",Re=s=>k.remove(s),Fe=(s,t)=>{let a=[];if(k.get(s)&&(a=k.get(s)),a.indexOf(t)===-1)return a.unshift(t),a.length>10&&a.pop(),k.set(s,a),a;{const r=a.indexOf(t),i=[...a];return i.splice(0,0,...i.splice(r,1)),localStorage.setItem(Me,JSON.stringify(i)),i}},D=function(s){var t=s.title,a=s.subtitle;return e(f,{space:2,className:"px-4 py-2","data-testid":"no-results"},void 0,e(h,{weight:"bold",size:"lg"},void 0,t),e(h,{theme:"muted"},void 0,a))},Ie=function(s){var t=s.onSelect,a=V(),r=a.account,i=w.useState(k.get(r==null?void 0:r.id)||[]),d=x(i,2),g=d[0],u=d[1],n=function(){Re(r==null?void 0:r.id),u([])};return e(f,{space:2,"data-testid":"recent-searches"},void 0,g.length>0?b.createElement(b.Fragment,null,e(y,{alignItems:"center",justifyContent:"between",className:"bg-white dark:bg-gray-900"},void 0,e(h,{theme:"muted",weight:"semibold",size:"sm"},void 0,e(p,{id:"groups.discover.search.recent_searches.title",defaultMessage:"Recent searches"})),e("button",{onClick:n,"data-testid":"clear-recent-searches"},void 0,e(h,{theme:"primary",size:"sm",className:"hover:underline"},void 0,e(p,{id:"groups.discover.search.recent_searches.clear_all",defaultMessage:"Clear all"})))),e(H,{useWindowScroll:!0,data:g,itemContent:function(S,m){return e("div",{"data-testid":"recent-search"},m,e("button",{onClick:function(){return t(m)},className:"group flex w-full flex-col rounded-lg p-2 hover:bg-gray-100 dark:hover:bg-gray-800","data-testid":"recent-search-result"},void 0,e(y,{alignItems:"center",space:2},void 0,e("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 p-2 dark:bg-gray-800 dark:group-hover:bg-gray-700/20"},void 0,e(C,{src:W,className:"h-5 w-5 text-gray-600"})),e(h,{weight:"bold",size:"sm",align:"left"},void 0,m))))}})):e(f,{space:2,"data-testid":"recent-searches-blankslate"},void 0,e(h,{weight:"bold",size:"lg"},void 0,e(p,{id:"groups.discover.search.recent_searches.blankslate.title",defaultMessage:"No recent searches"})),e(h,{theme:"muted"},void 0,e(p,{id:"groups.discover.search.recent_searches.blankslate.subtitle",defaultMessage:"Search group names, topics or keywords"}))))};var Te=["context"],ze=b.forwardRef(function(s,t){s.context;var a=le(s,Te);return b.createElement("div",A({ref:t},a,{className:"flex flex-wrap"}))});const Le=function(s){var t=s.groupSearchResult,a=w.useState(j.LIST),r=x(a,2),i=r[0],d=r[1],g=t.groups,u=t.hasNextPage,n=t.isFetching,l=t.fetchNextPage,S=function(){u&&!n&&l()},m=w.useCallback(function(o,c){return e("div",{className:ue({"pt-4":c!==0})},void 0,e(xe,{group:o,withJoinAction:!0}))},[]),v=w.useCallback(function(o){return e(I,{group:o})},[]);return e(f,{space:4,"data-testid":"results"},void 0,e(y,{alignItems:"center",justifyContent:"between"},void 0,e(h,{weight:"semibold"},void 0,e(p,{id:"groups.discover.search.results.groups",defaultMessage:"Groups"})),e(_e,{layout:i,onSelect:function(c){return d(c)}})),i===j.LIST?e(H,{useWindowScroll:!0,data:g,itemContent:function(c,_){return m(_,c)},endReached:S}):e(ye,{useWindowScroll:!0,data:g,itemContent:function(c,_){return v(_)},components:{Item:function(c){return b.createElement("div",A({},c,{className:"w-1/2 flex-none pb-4 [&:nth-last-of-type(-n+2)]:pb-0"}))},List:ze},endReached:S}))},je=function(s){var t=s.onSelect,a=s.searchValue,r=V(),i=r.account,d=we,g=d(a,300),u=d(a,1e3),n=Pe(g),l=n.groups,S=n.isLoading,m=n.isFetched,v=n.isError,o=m&&l.length>0,c=m&&l.length===0;return w.useEffect(function(){u&&u.length>=0&&Fe(i==null?void 0:i.id,u)},[u]),S?e(f,{space:4},void 0,e(R,{}),e(R,{}),e(R,{})):v?e(D,{title:e(p,{id:"groups.discover.search.error.title",defaultMessage:"An error occurred"}),subtitle:e(p,{id:"groups.discover.search.error.subtitle",defaultMessage:"Please try again later."})}):c?e(D,{title:e(p,{id:"groups.discover.search.no_results.title",defaultMessage:"No matches found"}),subtitle:e(p,{id:"groups.discover.search.no_results.subtitle",defaultMessage:"Try searching for another group."})}):o?e(Le,{groupSearchResult:n}):e(Ie,{onSelect:t})};var De=function(){var t=ke(),a=t.groups,r=t.isFetching,i=t.isFetched,d=t.isError,g=i&&a.length===0||d,u=w.useState(null),n=x(u,2),l=n[0],S=n[1];return e(f,{space:4,"data-testid":"suggested-groups"},void 0,e(y,{alignItems:"center",justifyContent:"between"},void 0,e(h,{size:"xl",weight:"bold"},void 0,e(p,{id:"groups.discover.suggested.title",defaultMessage:"Suggested For You"})),e(F,{to:"/groups/suggested"},void 0,e(h,{tag:"span",weight:"medium",size:"sm",theme:"inherit"},void 0,e(p,{id:"groups.discover.suggested.show_more",defaultMessage:"Show More"})))),g?e(h,{theme:"muted"},void 0,e(p,{id:"groups.discover.suggested.empty",defaultMessage:"Unable to fetch suggested groups at this time. Please check back later."})):e(O,{itemWidth:250,itemCount:a.length,controlsHeight:l==null?void 0:l.clientHeight,isDisabled:r},void 0,function(m){var v=m.width;return b.createElement(b.Fragment,null,r?new Array(20).fill(0).map(function(o,c){return e("div",{className:"relative flex shrink-0 flex-col space-y-2 px-0.5",style:{width:v||"auto"}},c,e(q,{}))}):a.map(function(o){return b.createElement(I,{key:o.id,group:o,width:v,ref:S})}))}))},Ve=me({placeholder:{id:"groups.discover.search.placeholder",defaultMessage:"Search"}}),Ze=function(){var t=ce(),a=w.useState(!1),r=x(a,2),i=r[0],d=r[1],g=w.useState(""),u=x(g,2),n=u[0],l=u[1],S=n&&n.length>0,m=function(){v(),d(!1)},v=function(){return l("")};return e(f,{space:4},void 0,e(Ce,{activeTab:Ne.FIND_GROUPS}),e(f,{space:6},void 0,e(y,{alignItems:"center"},void 0,i?b.createElement(de,{src:ge,iconClassName:"mr-2 h-5 w-5 fill-current text-gray-600",ref:he("Backspace"),onClick:m,"data-testid":"group-search-icon"}):null,e(ve,{"data-testid":"search",type:"text",placeholder:t.formatMessage(Ve.placeholder),value:n,onChange:function(c){return l(c.target.value)},onFocus:function(){return d(!0)},outerClassName:"mt-0 w-full",theme:"search",append:e("button",{onClick:v},void 0,e(C,{src:S?pe:W,className:"h-4 w-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))})),i?e(je,{searchValue:n,onSelect:function(c){return l(c)}}):b.createElement(b.Fragment,null,e(Ge,{}),e(De,{}),e(Ee,{}))))};export{Ze as default};
