import{d as $,r as s,aP as q,q as h,a8 as Q,ax as D,kg as z,Q as K,aQ as V,a as n,aG as j,aS as _,bO as B,e9 as H,a3 as J,R as E,F as X,aT as Y,aU as Z,dh as ee,O as P}from"../index-0bee5b8a.js";import{S as te}from"./scrollable-list-02ac982e.js";import{P as ae}from"./pending-status-249c9a74.js";import{g as re,a as ne}from"./thread-ad552151.js";import"./index-824e77ac.js";import"./load-more-f445dc02.js";import"./poll-preview-5775e706.js";import"./noop-2c35274c.js";import"./status-container-9dbb34ab.js";var he=function(u){var l=$(),R=s.useCallback(q(),[]),r=h(function(a){return R(a,{id:u.params.statusId})}),f=h(function(a){return a.me}),d=h(function(a){var e=Q();if(r){var t=r.id;e=re(a,t),e=e.delete(t)}return e}),T=s.useState(!!r),S=D(T,2),v=S[0],y=S[1],k=s.useState(),g=D(k,2),c=g[0],b=g[1],L=s.useRef(null),M=s.useRef(null),N=function(){var a=Y(regeneratorRuntime.mark(function e(){var t,p,o,C;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=u.params,p=t.statusId,i.next=4,l(Z(p));case 4:o=i.sent,C=o.next,b(C);case 7:case"end":return i.stop()}},e)}));return function(){return a.apply(this,arguments)}}();s.useEffect(function(){N().then(function(){y(!0)}).catch(function(){y(!0)})},[u.params.statusId]),s.useEffect(function(){v&&f&&l(z("reply:".concat(u.params.statusId),r))},[v,f]);var I=function(e){var t=P(d).indexOf(e);w(t-1)},x=function(e){var t=P(d).indexOf(e);w(t+1)},w=function(e){var t;(t=M.current)===null||t===void 0||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var o=document.querySelector('#thread [data-index="'.concat(e,'"] .focusable'));o&&o.focus()}})},A=function(e){return n("div",{className:"py-4 pb-8"},void 0,n(ee,{id:e,onMoveUp:I,onMoveDown:x},e))},O=function(e){return n(ne,{id:e,focusedStatusId:r.id,onMoveUp:I,onMoveDown:x},e)},U=function(e){var t=e.replace(/^末pending-/,"");return n(ae,{idempotencyKey:t,thread:!0},e)},F=function(e){return e.map(function(t){return t.endsWith("-tombstone")?A(t):t.startsWith("末pending-")?U(t):O(t)})},W=s.useCallback(K(function(){c&&r&&l(V(r.id,c)).then(function(a){var e=a.next;b(e)}).catch(function(){})},300,{leading:!0}),[c,r]),G=d.size>0;if(!r&&v)return n(j,{});if(!r)return n(_,{showPrivacyIndicator:!0});var m=[];return G&&m.push.apply(m,B(F(d).toArray())),n(J,{space:2},void 0,f&&n("div",{className:"border-b border-solid border-gray-200 p-2 pt-0 dark:border-gray-800"},void 0,n(H,{id:"reply:".concat(r.id),autoFocus:!1,event:r.id})),E.createElement("div",{ref:L,className:"thread p-0 shadow-none sm:p-2"},E.createElement(te,{id:"thread",ref:M,hasMore:!!c,onLoadMore:W,placeholderComponent:function(){return n(_,{showPrivacyIndicator:!0,variant:"slim"})},initialTopMostItemIndex:0,emptyMessage:n(X,{id:"event.discussion.empty",defaultMessage:"No one has commented this event yet. When someone does, they will appear here."})},m)))};export{he as default};
