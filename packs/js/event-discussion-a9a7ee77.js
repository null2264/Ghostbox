import{d as q,r as s,aM as G,q as h,b9 as Q,au as C,kh as z,Q as K,aN as V,a as n,aD as j,aP as _,bL as B,e8 as H,a3 as J,R,F as X,aQ as Y,aR as Z,dg as ee,O as E}from"../index-f3818f71.js";import{S as te}from"./scrollable-list-7c29d18a.js";import{P as ae}from"./pending-status-fc9fdf7f.js";import{g as re,a as ne}from"./thread-2b346275.js";import"./index-a5775da9.js";import"./load-more-d5c5812f.js";import"./poll-preview-7b194808.js";import"./noop-021b4dae.js";import"./status-container-079e7104.js";var he=function(u){var l=q(),P=s.useCallback(G(),[]),r=h(function(a){return P(a,{id:u.params.statusId})}),f=h(function(a){return a.me}),d=h(function(a){var e=Q();if(r){var t=r.id;e=re(a,t),e=e.delete(t)}return e}),k=s.useState(!!r),S=C(k,2),v=S[0],y=S[1],L=s.useState(),b=C(L,2),c=b[0],g=b[1],N=s.useRef(null),M=s.useRef(null),T=function(){var a=Y(regeneratorRuntime.mark(function e(){var t,p,o,D;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t=u.params,p=t.statusId,i.next=4,l(Z(p));case 4:o=i.sent,D=o.next,g(D);case 7:case"end":return i.stop()}},e)}));return function(){return a.apply(this,arguments)}}();s.useEffect(function(){T().then(function(){y(!0)}).catch(function(){y(!0)})},[u.params.statusId]),s.useEffect(function(){v&&f&&l(z("reply:".concat(u.params.statusId),r))},[v,f]);var I=function(e){var t=E(d).indexOf(e);x(t-1)},w=function(e){var t=E(d).indexOf(e);x(t+1)},x=function(e){var t;(t=M.current)===null||t===void 0||t.scrollIntoView({index:e,behavior:"smooth",done:function(){var o=document.querySelector('#thread [data-index="'.concat(e,'"] .focusable'));o&&o.focus()}})},A=function(e){return n("div",{className:"py-4 pb-8"},void 0,n(ee,{id:e,onMoveUp:I,onMoveDown:w},e))},F=function(e){return n(ne,{id:e,focusedStatusId:r.id,onMoveUp:I,onMoveDown:w},e)},O=function(e){var t=e.replace(/^末pending-/,"");return n(ae,{idempotencyKey:t,thread:!0},e)},U=function(e){return e.map(function(t){return t.endsWith("-tombstone")?A(t):t.startsWith("末pending-")?O(t):F(t)})},W=s.useCallback(K(function(){c&&r&&l(V(r.id,c)).then(function(a){var e=a.next;g(e)}).catch(function(){})},300,{leading:!0}),[c,r]),$=d.size>0;if(!r&&v)return n(j,{});if(!r)return n(_,{showPrivacyIndicator:!0});var m=[];return $&&m.push.apply(m,B(U(d).toArray())),n(J,{space:2},void 0,f&&n("div",{className:"border-b border-solid border-gray-200 p-2 pt-0 dark:border-gray-800"},void 0,n(H,{id:"reply:".concat(r.id),autoFocus:!1,event:r.id})),R.createElement("div",{ref:N,className:"thread p-0 shadow-none sm:p-2"},R.createElement(te,{id:"thread",ref:M,hasMore:!!c,onLoadMore:W,placeholderComponent:function(){return n(_,{showPrivacyIndicator:!0,variant:"slim"})},initialTopMostItemIndex:0,emptyMessage:n(X,{id:"event.discussion.empty",defaultMessage:"No one has commented this event yet. When someone does, they will appear here."})},m)))};export{he as default};
