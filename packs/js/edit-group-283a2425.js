import{bm as Z,kM as ee,bo as ae,bp as te,r as p,u as re,t as se,ea as oe,ax as w,q as ne,a,aF as ie,bH as ue,R as v,az as g,bI as C,F as f,bJ as de,A as le,dd as pe,b$ as ce,bL as me,ae as ve,X as ge,f3 as fe,f4 as he,o as _e,aT as be,bs as H,bO as $}from"../index-934baf30.js";import"./es.array.splice-4a867c5a.js";import{u as Se}from"./useGroupTags-0c3c0c3f.js";import{u as k}from"./useImageField-52054809.js";import{H as xe,A as ye}from"./header-picker-ad305c87.js";import{G as Ge}from"./group-tags-field-ad6fe8c8.js";import"./photo-plus-14444f2c.js";import"./streamfield-cfea8ba4.js";function Te(s){const t=Z(),{createEntity:o,...n}=ee([te.GROUPS],i=>t.put(`/api/v1/groups/${s}`,i,{headers:{"Content-Type":"multipart/form-data"}}),{schema:ae});return{updateGroup:o,...n}}function L(s){const[t,o]=p.useState(s),n=typeof s=="string",i=d=>{o(d.target.value)};return p.useEffect(()=>{n&&o(s)},[n]),{value:t||"",onChange:i}}var Ae=function(t){return t&&fe(t)?void 0:t},Ee=function(t){return t&&he(t)?void 0:t},h=_e({heading:{id:"navigation_bar.edit_group",defaultMessage:"Edit Group"},groupNamePlaceholder:{id:"manage_group.fields.name_placeholder",defaultMessage:"Group Name"},groupDescriptionPlaceholder:{id:"manage_group.fields.description_placeholder",defaultMessage:"Description"},groupSaved:{id:"group.update.success",defaultMessage:"Group successfully saved"}}),Ce=function(t){var o,n,i=t.params.groupId,d=re(),G=se(),T=oe(i),e=T.group,U=T.isLoading,q=Te(i),O=q.updateGroup,j=Se(i),z=j.invalidate,B=p.useState(!1),A=w(B,2),_=A[0],E=A[1],J=p.useState([""]),M=w(J,2),c=M[0],m=M[1],b=k({maxPixels:400*400,preview:Ae(e==null?void 0:e.avatar)}),S=k({maxPixels:1920*1080,preview:Ee(e==null?void 0:e.header)}),I=L(e==null?void 0:e.display_name),N=L(e==null?void 0:e.note_plain),W=Number(G.configuration.groups.max_characters_name),X=Number(G.configuration.groups.max_characters_description),R=(o=(n=ne(function(r){return r.instance.configuration.media_attachments.supported_mime_types}))===null||n===void 0?void 0:n.filter(function(r){return r.startsWith("image/")}).join(","))!==null&&o!==void 0?o:"";function K(){return x.apply(this,arguments)}function x(){return x=be(regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return E(!0),u.next=3,O({display_name:I.value,note:N.value,avatar:b.file===null?"":b.file,header:S.file===null?"":S.file,tags:c},{onSuccess:function(){z(),H.success(d.formatMessage(h.groupSaved))},onError:function(P){var l,y,F=(l=P.response)===null||l===void 0||(l=l.data)===null||l===void 0?void 0:l.error;((y=P.response)===null||y===void 0?void 0:y.status)===422&&typeof F<"u"&&H.error(F)}});case 3:E(!1);case 4:case"end":return u.stop()}},r)})),x.apply(this,arguments)}var Q=function(){m([].concat($(c),[""]))},V=function(D){var u=$(c);u.splice(D,1),m(u)};return p.useEffect(function(){e&&m(e.tags.map(function(r){return r.name}))},[e==null?void 0:e.id]),U?a(ie,{}):a(ge,{label:d.formatMessage(h.heading)},void 0,a(ue,{onSubmit:K},void 0,a("div",{className:"relative mb-12 flex"},void 0,v.createElement(xe,g({accept:R,disabled:_},S)),v.createElement(ye,g({accept:R,disabled:_},b))),a(C,{labelText:a(f,{id:"manage_group.fields.name_label_optional",defaultMessage:"Group name"}),hintText:a(f,{id:"manage_group.fields.cannot_change_hint",defaultMessage:"This cannot be changed after the group is created."})},void 0,v.createElement(de,g({type:"text",placeholder:d.formatMessage(h.groupNamePlaceholder),maxLength:W},I,{append:a(le,{className:"h-5 w-5 text-gray-600",src:pe}),disabled:!0}))),a(C,{labelText:a(f,{id:"manage_group.fields.description_label",defaultMessage:"Description"})},void 0,v.createElement(ce,g({autoComplete:"off",placeholder:d.formatMessage(h.groupDescriptionPlaceholder),maxLength:X},N))),a("div",{className:"pb-6"},void 0,a(Ge,{tags:c,onChange:m,onAddItem:Q,onRemoveItem:V})),a(me,{},void 0,a(ve,{theme:"primary",type:"submit",disabled:_,block:!0},void 0,a(f,{id:"edit_profile.save",defaultMessage:"Save"})))))};export{Ce as default};
