import{g2 as Qt,g3 as Ct,r as l,g4 as Jt,g5 as Xt,g6 as Zt,g7 as ea,g8 as xt,g9 as ta,ga as $e,gb as _t,gc as te,gd as aa,ge as na,gf as ra,gg as sa,gh as oa,gi as ia,a as e,c2 as la,A as re,dw as ca,dx as ua,d as he,W as D,dk as da,a6 as Xe,aH as Te,O as wt,R as N,aw as Ze,b$ as ma,az as ze,H as W,u as ae,g as Ve,fK as He,q as se,ax as z,a3 as B,y as T,ae as Ke,gj as ga,aK as Mt,gk as fa,o as ne,gl as va,gm as ha,fW as pa,b as kt,eX as ba,gn as St,cp as ya,go as Ca,fM as Ae,f0 as Nt,eg as Rt,gp as It,gq as xa,aL as ut,gr as _a,bQ as wa,gs as Ma,dq as dt,cP as Et,cr as Pt,bT as ka,gt as Sa,cF as Na,a9 as et,fO as Ra,gu as mt,c9 as Ge,bc as Ia,gv as Ea,aF as Dt,es as Pa,_ as Da,bO as Qe,bs as Tt,aT as Ta,gw as Aa,fy as Oa,bm as La,gx as Fa,gy as ja,gz as Ba,cA as At,fL as Ot,gA as Ka,bJ as Lt,aB as Ft,c as Ua,fV as $a,bD as za,gB as Va}from"../index-1fbe774d.js";import"./es.array.splice-8a0df521.js";import{V as tt}from"./index-4ef407a9.js";import{v as Ha}from"./mood-smile-6a052395.js";import{l as Ga}from"./lodash-25994466.js";import{u as Wa}from"./useDebounce-da1a3057.js";import{P as qa}from"./pull-to-refresh-64afd294.js";function Ya({autoEscape:r,caseSensitive:a=!1,findChunks:t=Bt,sanitize:n,searchWords:o,textToHighlight:s}){return Kt({chunksToHighlight:jt({chunks:t({autoEscape:r,caseSensitive:a,sanitize:n,searchWords:o,textToHighlight:s})}),totalLength:s?s.length:0})}function jt({chunks:r}){return r.sort((a,t)=>a.start-t.start).reduce((a,t)=>{if(a.length===0)return[t];{const n=a.pop();if(t.start<=n.end){const o=Math.max(n.end,t.end);a.push({highlight:!1,start:n.start,end:o})}else a.push(n,t);return a}},[])}function Bt({autoEscape:r,caseSensitive:a,sanitize:t=Qa,searchWords:n,textToHighlight:o}){return o=t(o||""),n.filter(s=>s).reduce((s,c)=>{c=t(c),r&&(c=Ja(c));const u=new RegExp(c,a?"g":"gi");let i;for(;i=u.exec(o||"");){let g=i.index,d=u.lastIndex;d>g&&s.push({highlight:!1,start:g,end:d}),i.index===u.lastIndex&&u.lastIndex++}return s},[])}function Kt({chunksToHighlight:r,totalLength:a}){const t=[];if(r.length===0)n(0,a,!1);else{let o=0;r.forEach(s=>{n(o,s.start,!1),n(s.start,s.end,!0),o=s.end}),n(o,a,!1)}return t;function n(o,s,c){s-o>0&&t.push({start:o,end:s,highlight:c})}}function Qa(r){return r}function Ja(r){return r.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}var Xa={combineChunks:jt,fillInChunks:Kt,findAll:Ya,findChunks:Bt},P="IDLE",Z="SUGGESTING",de="NAVIGATING",Me="INTERACTING",fe="CLEAR",xe="CHANGE",at="INITIAL_CHANGE",q="NAVIGATE",nt="SELECT_WITH_KEYBOARD",ve="SELECT_WITH_CLICK",ke="ESCAPE",_e="BLUR",Ue="INTERACT",we="FOCUS",We="OPEN_WITH_BUTTON",rt="OPEN_WITH_INPUT_CLICK",De="CLOSE_WITH_BUTTON",Za={initial:P,states:{[P]:{on:{[_e]:P,[fe]:P,[xe]:Z,[at]:P,[we]:Z,[q]:de,[We]:Z,[rt]:Z}},[Z]:{on:{[xe]:Z,[we]:Z,[q]:de,[fe]:P,[ke]:P,[_e]:P,[ve]:P,[Ue]:Me,[De]:P}},[de]:{on:{[xe]:Z,[we]:Z,[fe]:P,[_e]:P,[ke]:P,[q]:de,[ve]:P,[nt]:P,[De]:P,[Ue]:Me}},[Me]:{on:{[fe]:P,[xe]:Z,[we]:Z,[_e]:P,[ke]:P,[q]:de,[De]:P,[ve]:P}}}},en=(r,a)=>{let t={...r,lastEventType:a.type};switch(a.type){case xe:case at:return{...t,navigationValue:null,value:a.value};case q:case We:case rt:return{...t,navigationValue:gt(t,a)};case fe:return{...t,value:"",navigationValue:null};case _e:case ke:return{...t,navigationValue:null};case ve:return{...t,value:a.isControlled?r.value:a.value,navigationValue:null};case nt:return{...t,value:a.isControlled?r.value:r.navigationValue,navigationValue:null};case De:return{...t,navigationValue:null};case Ue:return t;case we:return{...t,navigationValue:gt(t,a)};default:return t}};function tn(r){return[Z,de,Me].includes(r)}function gt(r,a){return a.value?a.value:a.persistSelection?r.value:null}var st=Qt("ComboboxDescendantContext"),oe=Ct("ComboboxContext",{}),Ut=Ct("OptionContext",{}),$t=l.forwardRef(({onSelect:r,openOnFocus:a=!1,children:t,as:n="div","aria-label":o,"aria-labelledby":s,...c},u)=>{let[i,g]=Jt(),d=l.useRef(),m=l.useRef(),f=l.useRef(),w=l.useRef(!1),C=l.useRef(!1),x={value:"",navigationValue:null},[y,v,h]=rn(Za,en,x);nn(v.lastEventType,d);let _=Xt(c.id),k=_?Zt("listbox",_):"listbox",A=l.useRef(!1),R=tn(y),F={ariaLabel:o,ariaLabelledby:s,autocompletePropRef:w,buttonRef:f,comboboxId:_,data:v,inputRef:d,isExpanded:R,listboxId:k,onSelect:r||ia,openOnFocus:a,persistSelectionRef:C,popoverRef:m,state:y,transition:h,isControlledRef:A};return l.createElement(ea,{context:st,items:i,set:g},l.createElement(oe.Provider,{value:F},l.createElement(n,{...c,"data-reach-combobox":"","data-state":it(y),"data-expanded":R||void 0,ref:u},xt(t)?t({id:_,isExpanded:R,navigationValue:v.navigationValue??null,state:y}):t)))});$t.displayName="Combobox";var zt=l.forwardRef(({as:r="input",selectOnClick:a=!1,autocomplete:t=!0,onClick:n,onChange:o,onKeyDown:s,onBlur:c,onFocus:u,value:i,...g},d)=>{let{current:m}=l.useRef(i),f=l.useRef(!1);ta(()=>{f.current=!0},[i]);let{data:{navigationValue:w,value:C,lastEventType:x},inputRef:y,state:v,transition:h,listboxId:_,autocompletePropRef:k,openOnFocus:A,isExpanded:R,ariaLabel:F,ariaLabelledby:S,persistSelectionRef:E,isControlledRef:p}=l.useContext(oe),V=$e(y,d),X=l.useRef(!1),Y=ot(),ee=qt(),j=typeof i<"u",Q=typeof m<"u";!j&&Q&&console.warn("ComboboxInput is changing from controlled to uncontrolled. ComboboxInput should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled ComboboxInput for the lifetime of the component. Check the `value` prop being passed in."),j&&!Q&&console.warn("ComboboxInput is changing from uncontrolled to controlled. ComboboxInput should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled ComboboxInput for the lifetime of the component. Check the `value` prop being passed in."),l.useEffect(()=>{p.current=j},[j]),_t(()=>{k.current=t},[t,k]);let O=l.useCallback(M=>{M.trim()===""?h(fe,{isControlled:j}):M===m&&!f.current?h(at,{value:M}):h(xe,{value:M})},[m,h,j]);l.useEffect(()=>{j&&i!==C&&(i.trim()!==""||(C||"").trim()!=="")&&O(i)},[i,O,j,C]),l.useEffect(()=>{var ie;let M=(ie=y.current)==null?void 0:ie.form;if(!M)return;function H(le){h(fe,{isControlled:j})}return M.addEventListener("reset",H),()=>{M==null||M.removeEventListener("reset",H)}},[y,j,h]);function G(M){let{value:H}=M.target;j||O(H)}function U(){a&&(X.current=!0),A&&x!==ve&&h(we,{persistSelection:E.current})}function b(){var M;X.current&&(X.current=!1,(M=y.current)==null||M.select()),A&&v===P&&h(rt)}let I=t&&(v===de||v===Me)?w||i||C:i||C;return l.createElement(r,{"aria-activedescendant":w?String(Yt(w)):void 0,"aria-autocomplete":"both","aria-controls":_,"aria-expanded":R,"aria-haspopup":"listbox","aria-label":F,"aria-labelledby":F?void 0:S,role:"combobox",...g,"data-reach-combobox-input":"","data-state":it(v),ref:V,onBlur:te(c,ee),onChange:te(o,G),onClick:te(n,b),onFocus:te(u,U),onKeyDown:te(s,Y),value:I||""})});zt.displayName="ComboboxInput";var Vt=l.forwardRef(({as:r="div",children:a,portal:t=!0,onKeyDown:n,onBlur:o,position:s=na,...c},u)=>{let{popoverRef:i,inputRef:g,isExpanded:d,state:m}=l.useContext(oe),f=$e(i,u),w=ot(),C=qt(),x={"data-reach-combobox-popover":"","data-state":it(m),onKeyDown:te(n,w),onBlur:te(o,C),hidden:!d,tabIndex:-1,children:a};return t?l.createElement(aa,{as:r,...c,ref:f,"data-expanded":d||void 0,position:s,targetRef:g,unstable_skipInitialPortalRender:!0,...x}):l.createElement(r,{ref:f,...c,...x})});Vt.displayName="ComboboxPopover";var Ht=l.forwardRef(({persistSelection:r=!1,as:a="ul",...t},n)=>{let{persistSelectionRef:o,listboxId:s}=l.useContext(oe);return r&&(o.current=!0),l.createElement(a,{role:"listbox",...t,ref:n,"data-reach-combobox-list":"",id:s})});Ht.displayName="ComboboxList";var Gt=l.forwardRef(({as:r="li",children:a,index:t,value:n,onClick:o,...s},c)=>{let{onSelect:u,data:{navigationValue:i},transition:g,isControlledRef:d}=l.useContext(oe),m=l.useRef(null),[f,w]=ra(m,null),C=l.useMemo(()=>({element:f,value:n}),[n,f]),x=sa(C,st,t),y=$e(c,w),v=i===n,h=()=>{u&&u(n),g(ve,{value:n,isControlled:d.current})};return l.createElement(Ut.Provider,{value:{value:n,index:x}},l.createElement(r,{"aria-selected":v,role:"option",...s,"data-reach-combobox-option":"",ref:y,id:String(Yt(n)),"data-highlighted":v?"":void 0,tabIndex:-1,onClick:te(o,h)},a?xt(a)?a({value:n,index:x}):a:l.createElement(Wt,null)))});Gt.displayName="ComboboxOption";function Wt(){let{value:r}=l.useContext(Ut),{data:{value:a}}=l.useContext(oe),t=l.useMemo(()=>Xa.findAll({searchWords:sn(a||"").split(/\s+/),textToHighlight:r}),[a,r]);return l.createElement(l.Fragment,null,t.length?t.map((n,o)=>{let s=r.slice(n.start,n.end);return l.createElement("span",{key:o,"data-reach-combobox-option-text":"","data-user-value":n.highlight?!0:void 0,"data-suggested-value":n.highlight?void 0:!0},s)}):r)}Wt.displayName="ComboboxOptionText";var an=l.forwardRef(({as:r="button",onClick:a,onKeyDown:t,...n},o)=>{let{transition:s,state:c,buttonRef:u,listboxId:i,isExpanded:g}=l.useContext(oe),d=$e(u,o),m=ot(),f=()=>{s(c===P?We:De)};return l.createElement(r,{"aria-controls":i,"aria-haspopup":"listbox","aria-expanded":g,...n,"data-reach-combobox-button":"",ref:d,onClick:te(a,f),onKeyDown:te(t,m)})});an.displayName="ComboboxButton";function nn(r,a){_t(()=>{var t;(r===q||r===ke||r===ve||r===We)&&((t=a.current)==null||t.focus())},[a,r])}function ot(){let{data:{navigationValue:r},onSelect:a,state:t,transition:n,autocompletePropRef:o,persistSelectionRef:s,inputRef:c,isControlledRef:u}=l.useContext(oe),i=oa(st);return function(d){var v;let m=i.findIndex(({value:h})=>h===r);function f(){return m===i.length-1?o.current?null:C():i[(m+1)%i.length]}function w(){return m===0?o.current?null:x():m===-1?x():i[(m-1+i.length)%i.length]}function C(){return i[0]}function x(){return i[i.length-1]}let y=((v=c.current)==null?void 0:v.tagName.toUpperCase())==="TEXTAREA"&&c.current.value.includes(`
`);switch(d.key){case"ArrowDown":if(!i||!i.length)return;if(t===P){if(y)return;d.preventDefault(),n(q,{persistSelection:s.current})}else{d.preventDefault();let h=f();n(q,{value:h?h.value:null})}break;case"ArrowUp":if(!i||!i.length)return;if(t===P){if(y)return;d.preventDefault(),n(q,{persistSelection:s.current})}else{d.preventDefault();let h=w();n(q,{value:h?h.value:null})}break;case"Home":case"PageUp":if(d.preventDefault(),!i||i.length===0)return;t===P?n(q):n(q,{value:C().value});break;case"End":case"PageDown":if(d.preventDefault(),!i||i.length===0)return;t===P?n(q):n(q,{value:x().value});break;case"Escape":t!==P&&n(ke);break;case"Enter":t===de&&r!==null&&(d.preventDefault(),a&&a(r),n(nt,{isControlled:u.current}));break}}}function qt(){let{state:r,transition:a,popoverRef:t,inputRef:n,buttonRef:o}=l.useContext(oe);return function(c){let u=t.current,i=n.current,g=o.current,d=c.relatedTarget;d!==i&&d!==g&&u&&(u.contains(d)?r!==Me&&a(Ue):a(_e))}}function rn(r,a,t){let[n,o]=l.useState(r.initial),[s,c]=l.useReducer(a,t);return[n,s,(i,g={})=>{let d=r.states[n],m=d&&d.on[i];if(m){c({type:i,state:n,nextState:n,...g}),o(m);return}}]}function Yt(r){let a=0;if(r.length===0)return a;for(let t=0;t<r.length;t++)a=(a<<5)-a+r.charCodeAt(t),a=a&a;return a}function it(r){return r.toLowerCase()}function sn(r){return String(r).replace(/([.*+?=^!:${}()|[\]/\\])/g,"\\$1")}var on=function(a){var t=a.progress;return e("div",{className:"relative isolate inline-flex h-24 w-24 items-center justify-center overflow-hidden rounded-lg bg-gray-200 p-4 dark:bg-primary-900"},void 0,e(la,{progress:t,size:"sm"}))},ln=ua,cn=function(a){a.className;var t=a.attachment,n=t.pleroma.get("mime_type");switch(t.type){case"image":case"gifv":return e("img",{className:"pointer-events-none h-full w-full object-cover",src:t.preview_url,alt:""});case"video":return e("video",{className:"pointer-events-none h-full w-full object-cover",src:t.preview_url,autoPlay:!0,playsInline:!0,controls:!1,muted:!0,loop:!0});default:return e("div",{className:"pointer-events-none flex h-full w-full items-center justify-center"},void 0,e(re,{className:"mx-auto my-12 h-16 w-16 text-gray-800 dark:text-gray-200",src:ca[n||""]||ln}))}},un=function(a){var t=a.attachment,n=a.onDelete,o=he(),s=t.type!=="unknown",c=function(){o(Te("MEDIA",{media:wt.of(t),index:0}))};return e("div",{className:"relative isolate inline-block h-24 w-24 overflow-hidden rounded-lg bg-gray-200 dark:bg-primary-900"},void 0,e(da,{hash:t.blurhash,className:"absolute inset-0 -z-10 h-full w-full"}),e("div",{className:"absolute right-[6px] top-[6px]"},void 0,e(dn,{onClick:n})),e("button",{onClick:s?c:void 0,className:D("h-full w-full",{"cursor-zoom-in":s,"cursor-default":!s})},void 0,e(cn,{attachment:t})))},dn=function(a){var t=a.onClick;return e("button",{type:"button",onClick:t,className:"flex h-5 w-5 items-center justify-center rounded-full bg-secondary-500 p-1"},void 0,e(re,{className:"h-3 w-3 text-white",src:Xe}))},mn=["attachments","onDeleteAttachment","uploadCount","uploadProgress"],gn=N.forwardRef(function(r,a){var t=r.attachments,n=r.onDeleteAttachment,o=r.uploadCount,s=o===void 0?0:o,c=r.uploadProgress,u=c===void 0?0:c,i=Ze(r,mn),g=s>0,d=function(f){return function(){n&&n(f)}};return e("div",{className:`
      block
      w-full
      rounded-md border border-gray-400
      bg-white text-gray-900
      shadow-sm placeholder:text-gray-600
      focus-within:border-primary-500
      focus-within:ring-1 focus-within:ring-primary-500 dark:border-gray-800 dark:bg-gray-800
      dark:text-gray-100 dark:ring-1 dark:ring-gray-800 dark:placeholder:text-gray-600 dark:focus-within:border-primary-500
      dark:focus-within:ring-primary-500 sm:text-sm
    `},void 0,(!!(t!=null&&t.length)||g)&&e(W,{className:"-ml-2 -mt-2 p-3 pb-0",wrap:!0},void 0,t==null?void 0:t.map(function(m,f){return e("div",{className:"ml-2 mt-2 flex"},void 0,e(un,{attachment:m,onDelete:d(f)},m.id))}),Array.from(Array(s)).map(function(){return e("div",{className:"ml-2 mt-2 flex"},void 0,e(on,{progress:u}))})),N.createElement(ma,ze({ref:a,theme:"transparent"},i)))}),me=ne({placeholder:{id:"chat.input.placeholder",defaultMessage:"Type a message"},send:{id:"chat.actions.send",defaultMessage:"Send"},retry:{id:"chat.retry",defaultMessage:"Retry?"},blocked:{id:"chat_message_list.blocked",defaultMessage:"You blocked this user"},unblock:{id:"chat_composer.unblock",defaultMessage:"Unblock"},unblockMessage:{id:"chat_settings.unblock.message",defaultMessage:"Unblocking will allow this profile to direct message you and view your content."},unblockHeading:{id:"chat_settings.unblock.heading",defaultMessage:"Unblock @{acct}"},unblockConfirm:{id:"chat_settings.unblock.confirm",defaultMessage:"Unblock"}}),Je={list:[],tokenStart:0,token:""},fn=N.forwardRef(function(r,a){var t=r.onKeyDown,n=r.onChange,o=r.value,s=r.onSubmit,c=r.errorMessage,u=c===void 0?!1:c,i=r.disabled,g=i===void 0?!1:i,d=r.onSelectFile,m=r.resetFileKey,f=r.resetContentKey,w=r.onPaste,C=r.attachments,x=C===void 0?[]:C,y=r.onDeleteAttachment,v=r.uploadCount,h=v===void 0?0:v,_=r.uploadProgress,k=ae(),A=he(),R=Ve(),F=He(),S=F.chat,E=se(function($){var K;return $.getIn(["relationships",S==null||(K=S.account)===null||K===void 0?void 0:K.id,"blocked_by"])}),p=se(function($){var K;return $.getIn(["relationships",S==null||(K=S.account)===null||K===void 0?void 0:K.id,"blocking"])}),V=se(function($){return $.instance.configuration.chats.max_characters}),X=se(function($){return $.instance.configuration.chats.max_media_attachments}),Y=l.useState(Je),ee=z(Y,2),j=ee[0],Q=ee[1],O=j.list.length>0,G=h>0,U=x.length>0,b=V&&(o==null?void 0:o.length)>V,I=g||G||b||o.length===0&&!U,M=V?V-(o==null?void 0:o.length):"",H=function(K){return"".concat(o.slice(0,j.tokenStart)).concat(K.native," ").concat(o.slice(j.tokenStart+j.token.length))},ie=function(K){var Se={target:{value:K}};n&&(n(Se),Q(Je))},le=function(K){var Se=va(K.target.value,K.target.selectionStart,[":"]),Le=z(Se,2),Fe=Le[0],Ne=Le[1];if(Ne&&Fe){var Ye=ha(Ne.replace(":",""),{maxResults:5});Q({list:Ye,token:Ne,tokenStart:Fe-1})}else Q(Je);n&&n(K)},Oe=function(K){K.key==="Enter"&&!K.shiftKey&&O||t&&t(K)},qe=function(){A(Te("CONFIRM",{heading:k.formatMessage(me.unblockHeading,{acct:S==null?void 0:S.account.acct}),message:k.formatMessage(me.unblockMessage),confirm:k.formatMessage(me.unblockConfirm),confirmationTheme:"primary",onConfirm:function(){return A(pa(S==null?void 0:S.account.id))}}))};return p?e("div",{className:"mt-auto p-6 shadow-3xl dark:border-t-2 dark:border-solid dark:border-gray-800"},void 0,e(B,{space:3,alignItems:"center"},void 0,e(T,{align:"center",theme:"muted"},void 0,k.formatMessage(me.blocked)),e(Ke,{theme:"secondary",onClick:qe},void 0,k.formatMessage(me.unblock)))):E?null:e("div",{className:"mt-auto px-4 shadow-3xl"},void 0,e("div",{className:"h-5"}),e(W,{alignItems:"stretch",justifyContent:"between",space:4},void 0,R.chatsMedia&&e(B,{justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,e(ga,{onSelectFile:d,resetFileKey:m,iconClassName:"h-5 w-5",className:"text-primary-500",disabled:G||x.length>=X})),e(B,{grow:!0},void 0,e($t,{onSelect:ie},void 0,N.createElement(zt,{key:f,as:gn,autoFocus:!0,ref:a,placeholder:k.formatMessage(me.placeholder),onKeyDown:Oe,value:o,onChange:le,onPaste:w,isResizeable:!1,autoGrow:!0,maxRows:5,disabled:g,attachments:x,onDeleteAttachment:y,uploadCount:h,uploadProgress:_}),O?e(Vt,{},void 0,e(Ht,{},void 0,j.list.map(function($){return e(Gt,{value:H($)},$.colons,e("span",{},void 0,$.native),e("span",{className:"ml-1"},void 0,$.colons))}))):null)),e(B,{space:2,justifyContent:"end",alignItems:"center",className:"mb-1.5 w-10"},void 0,b?e(T,{size:"sm",theme:"danger"},void 0,M):null,e(Mt,{src:fa,iconClassName:"h-5 w-5",className:"text-primary-500",disabled:I,onClick:s}))),e(W,{alignItems:"center",className:"h-5",space:1},void 0,u&&N.createElement(N.Fragment,null,e(T,{theme:"danger",size:"xs"},void 0,u),e("button",{onClick:s,className:"flex hover:underline"},void 0,e(T,{theme:"primary",size:"xs",tag:"span"},void 0,k.formatMessage(me.retry))))))}),Ie=function(a){var t=a.isMyMessage,n=t===void 0?!1:t,o=ba(160,220);return e(B,{"data-testid":"placeholder-chat-message",space:1,className:D({"max-w-[85%] animate-pulse":!0,"ml-auto":n})},void 0,e(W,{alignItems:"center",justifyContent:n?"end":"start"},void 0,e("div",{className:D({"text-ellipsis break-words relative rounded-md p-2":!0,"mr-2":n,"order-2 ml-2":!n})},void 0,e("div",{style:{width:o,height:20},className:"rounded-full bg-primary-50 dark:bg-primary-800"})),e("div",{className:D({"order-1":!n})},void 0,e(kt,{size:34}))),e(W,{alignItems:"center",space:2,className:D({"ml-auto":n})},void 0,e(T,{theme:"muted",size:"xs",className:D({"text-right":n,"order-2":!n})},void 0,e("span",{style:{width:50,height:12},className:"block rounded-full bg-primary-50 dark:bg-primary-800"})),e("div",{className:D({"order-1":!n})},void 0,e("div",{className:"ml-2 w-[34px]"}))))};const vn="/packs/assets/copy-292e64b6.svg";var hn=function(a){var t=a.emojiReaction,n=a.onAddReaction,o=a.onRemoveReaction,s=t.me,c=function(){s?o(t.name):n(t.name)};return e("button",{type:"button",onClick:c,className:D({"w-12 rounded-lg flex justify-between text-sm border items-center border-solid text-gray-700 dark:text-gray-600 px-2 py-1 space-x-1.5 transition-colors hover:bg-gray-200 dark:hover:bg-gray-800 whitespace-nowrap":!0,"border-primary-500 dark:border-primary-400":t.me,"border-gray-300 dark:border-gray-800":!t.me})},void 0,e("span",{dangerouslySetInnerHTML:{__html:St(t.name)}}),e(T,{tag:"span",weight:"medium",size:"sm"},void 0,t.count))};function pn(r){var a=r.onOpen,t=r.onSelect,n=r.children,o=l.useState(!1),s=z(o,2),c=s[0],u=s[1],i=l.useState(null),g=z(i,2),d=g[0],m=g[1],f=function(x){t(x),u(!1)},w=function(){return u(function(x){return!x})};return l.useEffect(function(){a(c)},[c]),e(N.Fragment,{},void 0,N.cloneElement(n,{ref:m,onClick:w}),c&&e(ya,{},void 0,e(Ca,{visible:c,referenceElement:d,onReact:f,onClose:function(){return u(!1)},offsetOptions:{mainAxis:12,crossAxis:-10},all:!1})))}var ye=ne({copy:{id:"chats.actions.copy",defaultMessage:"Copy"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},more:{id:"chats.actions.more",defaultMessage:"More"},report:{id:"chats.actions.report",defaultMessage:"Report"}}),bn=3,yn=function(a){return a.get("emojis",wt()).reduce(function(t,n){return t.set(":".concat(n.get("shortcode"),":"),n)},Na())},Cn=function(a){return Ga.escape(a).replace(/(?:\r\n|\r|\n)/g,"<br>")},xn=function(a){var t=a.content||"",n=a.pending,o=a.deleting,s=n&&!o?Cn(t):t,c=yn(a);return St(s,c.toJS())},_n=function(a){var t,n,o=a.chat,s=a.chatMessage,c=he(),u=Ve(),i=ae(),g=se(function(b){return b.me}),d=Ae(o.id),m=d.createReaction,f=d.deleteChatMessage,w=d.deleteReaction,C=l.useState(!1),x=z(C,2),y=x[0],v=x[1],h=l.useState(!1),_=z(h,2),k=_[0],A=_[1],R=Nt(function(b){return f(b)},{onSettled:function(){Rt.invalidateQueries(It.chatMessages(o.id))}}),F=xn(s),S=(t=o.latest_read_message_by_account)===null||t===void 0||(t=t.find(function(b){return b.id===o.account.id}))===null||t===void 0?void 0:t.date,E=S?new Date(S):null,p=s.account_id===g,V=p&&E&&E>=new Date(s.created_at),X=l.useMemo(function(){var b=document.createElement("div");return b.innerHTML=F,xa(b,bn,!1)},[]),Y=l.useMemo(function(){return s.emoji_reactions?s.emoji_reactions.reduce(function(b,I,M){return(M%4===0?b.push([I]):b[b.length-1].push(I))&&b},[]):[]},[s.emoji_reactions]),ee=function(I,M){c(Te("MEDIA",{media:I,index:M}))},j=function(I){return I.media_attachments.size?N.createElement(N.Fragment,null,e(l.Suspense,{},void 0,e(ka,{className:D({"rounded-br-sm":p&&F,"rounded-bl-sm":!p&&F}),media:I.media_attachments,onOpenMedia:ee,visible:!0}))):null},Q=function(I){if(navigator.clipboard){var M=Sa(I.content);navigator.clipboard.writeText(M)}},O=function(I){if(I){var M=I.querySelectorAll('a[rel="ugc"]');M.forEach(function(H){H.classList.add("chat-link"),H.setAttribute("rel","ugc nofollow noopener"),H.setAttribute("target","_blank")})}},G=function(I){return i.formatDate(new Date(I.created_at),{hour12:!1,year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})},U=l.useMemo(function(){var b=[];return navigator.clipboard&&s.content&&b.push({text:i.formatMessage(ye.copy),action:function(){return Q(s)},icon:vn}),p?b.push({text:i.formatMessage(ye.delete),action:function(){return R.mutate(s.id)},icon:ut,destructive:!0}):(u.reportChats&&b.push({text:i.formatMessage(ye.report),action:function(){return c(_a(wa.CHAT_MESSAGE,o.account,{chatMessage:s}))},icon:Ma}),b.push({text:i.formatMessage(ye.deleteForMe),action:function(){return R.mutate(s.id)},icon:ut,destructive:!0})),b},[s,o]);return e("div",{className:D({"group relative px-4 py-2 hover:bg-gray-200/40 dark:hover:bg-gray-800/40":!0,"bg-gray-200/40 dark:bg-gray-800/40":k||y}),"data-testid":"chat-message"},void 0,e("div",{className:D({"p-1 flex items-center space-x-0.5 z-10 absolute opacity-0 transition-opacity group-hover:opacity-100 focus:opacity-100 rounded-md shadow-lg bg-white dark:bg-gray-900 dark:ring-2 dark:ring-primary-700":!0,"top-2 right-2":!p,"top-2 left-2":p,"!opacity-100":k||y})},void 0,u.chatEmojiReactions&&e(pn,{onOpen:v,onSelect:function(I){return m.mutate({emoji:I,messageId:s.id,chatMessage:s})}},void 0,e("button",{title:i.formatMessage(ye.more),className:D({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":y})},void 0,e(re,{src:Ha,className:"h-4 w-4"}))),U.length>0&&e(Et,{items:U,onOpen:function(){return A(!0)},onClose:function(){return A(!1)}},void 0,e("button",{title:i.formatMessage(ye.more),className:D({"p-1.5 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-md text-gray-600 dark:text-gray-600 hover:text-gray-700 dark:hover:text-gray-500 focus:text-gray-700 dark:focus:text-gray-500 focus:ring-0":!0,"!text-gray-700 dark:!text-gray-500":k}),"data-testid":"chat-message-menu"},void 0,e(re,{src:Pt,className:"h-4 w-4"})))),e(B,{space:1.5,className:D({"ml-auto":p})},void 0,e(W,{alignItems:"center",justifyContent:p?"end":"start",className:D({"opacity-50":s.pending})},void 0,e(B,{space:.5,className:D({"max-w-[85%]":!0,"flex-1":!!s.media_attachments.size,"order-3":p,"order-1":!p}),alignItems:p?"end":"start"},void 0,j(s),F&&e(W,{alignItems:"bottom",className:"max-w-full"},void 0,N.createElement("div",{title:G(s),className:D({"text-ellipsis break-words relative rounded-md py-2 px-3 max-w-full space-y-2 [&_.mention]:underline":!0,"rounded-tr-sm":!!s.media_attachments.size&&p,"rounded-tl-sm":!!s.media_attachments.size&&!p,"[&_.mention]:text-primary-600 dark:[&_.mention]:text-accent-blue":!p,"[&_.mention]:text-white dark:[&_.mention]:white":p,"bg-primary-500 text-white":p,"bg-gray-200 dark:bg-gray-800 text-gray-900 dark:text-gray-100":!p,"!bg-transparent !p-0 emoji-lg":X}),ref:O,tabIndex:0},e(T,{size:"sm",theme:"inherit",className:"break-word-nested",dangerouslySetInnerHTML:{__html:F}}))))),(n=s.emoji_reactions)!==null&&n!==void 0&&n.length?e("div",{className:D({"space-y-1":!0,"ml-auto":p,"mr-auto":!p})},void 0,Y==null?void 0:Y.map(function(b,I){return e(W,{className:D({"flex items-center gap-1":!0,"flex-row-reverse":p})},I,b.map(function(M,H){return e(hn,{emojiReaction:M,onAddReaction:function(le){return m.mutate({emoji:le,messageId:s.id,chatMessage:s})},onRemoveReaction:function(le){return w.mutate({emoji:le,messageId:s.id})}},H)}))})):null,e(W,{alignItems:"center",space:2,className:D({"ml-auto":p})},void 0,e("div",{className:D({"text-right":p,"order-2":!p})},void 0,e("span",{className:"flex items-center space-x-1.5"},void 0,e(T,{theme:"muted",size:"xs"},void 0,i.formatTime(s.created_at)),p&&u.chatsReadReceipts?N.createElement(N.Fragment,null,V?e("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-primary-500 p-0.5 text-white dark:border-primary-400 dark:bg-primary-400 dark:text-primary-900"},void 0,e(re,{src:dt,strokeWidth:3,className:"h-2.5 w-2.5"})):e("span",{className:"flex flex-col items-center justify-center rounded-full border border-solid border-primary-500 bg-transparent p-0.5 text-primary-500 dark:border-primary-400 dark:text-primary-400"},void 0,e(re,{src:dt,strokeWidth:3,className:"h-2.5 w-2.5"}))):null)))))};const wn="/packs/assets/clock-c21718f2.svg";var ge=ne({leaveChatHeading:{id:"chat_message_list_intro.leave_chat.heading",defaultMessage:"Leave Chat"},leaveChatMessage:{id:"chat_message_list_intro.leave_chat.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveChatConfirm:{id:"chat_message_list_intro.leave_chat.confirm",defaultMessage:"Leave Chat"},intro:{id:"chat_message_list_intro.intro",defaultMessage:"wants to start a chat with you"},accept:{id:"chat_message_list_intro.actions.accept",defaultMessage:"Accept"},leaveChat:{id:"chat_message_list_intro.actions.leave_chat",defaultMessage:"Leave chat"},report:{id:"chat_message_list_intro.actions.report",defaultMessage:"Report"},messageLifespan:{id:"chat_message_list_intro.actions.message_lifespan",defaultMessage:"Messages older than {day, plural, one {# day} other {# days}} are deleted."}}),Mn=function(){var a=he(),t=ae(),n=Ve(),o=et(),s=He(),c=s.chat,u=s.isUsingMainChatPage,i=s.needsAcceptance,g=Ae(c==null?void 0:c.id),d=g.acceptChat,m=g.deleteChat,f=function(){a(Te("CONFIRM",{heading:t.formatMessage(ge.leaveChatHeading),message:t.formatMessage(ge.leaveChatMessage),confirm:t.formatMessage(ge.leaveChatConfirm),confirmationTheme:"primary",onConfirm:function(){m.mutate(void 0,{onSuccess:function(){u&&o.push("/chats")}})}}))};return!c||!n.chatAcceptance?null:e(B,{"data-testid":"chat-message-list-intro",justifyContent:"center",alignItems:"center",space:4,className:D({"w-3/4 mx-auto":i,"py-6":!0})},void 0,e(B,{alignItems:"center",space:2},void 0,e(mt,{to:"/@".concat(c.account.acct)},void 0,e(Ge,{src:c.account.avatar_static,size:75})),e(T,{size:"lg",align:"center"},void 0,i?N.createElement(N.Fragment,null,e(T,{tag:"span",weight:"semibold"},void 0,"@",c.account.acct)," ",e(T,{tag:"span"},void 0,t.formatMessage(ge.intro))):e(mt,{to:"/@".concat(c.account.acct)},void 0,e(T,{tag:"span",theme:"inherit",weight:"semibold"},void 0,"@",c.account.acct)))),i?e(W,{alignItems:"center",space:2,className:"w-full"},void 0,e(Ke,{theme:"primary",block:!0,onClick:function(){return d.mutate()},disabled:d.isLoading},void 0,t.formatMessage(ge.accept)),e(Ke,{theme:"danger",block:!0,onClick:f},void 0,t.formatMessage(ge.leaveChat))):e(W,{justifyContent:"center",alignItems:"center",space:1,className:"shrink-0"},void 0,e(re,{src:wn,className:"h-4 w-4 text-gray-600"}),c.message_expiration&&e(T,{size:"sm",theme:"muted"},void 0,t.formatMessage(ge.messageLifespan,{day:Ra(c.message_expiration)}))))},kn=["context"],Sn=["style","context"];function ft(r,a){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);a&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(r,o).enumerable})),t.push.apply(t,n)}return t}function vt(r){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?ft(Object(t),!0).forEach(function(n){Da(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ft(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Ee=ne({today:{id:"chats.dividers.today",defaultMessage:"Today"},more:{id:"chats.actions.more",defaultMessage:"More"},delete:{id:"chats.actions.delete",defaultMessage:"Delete for both"},copy:{id:"chats.actions.copy",defaultMessage:"Copy"},report:{id:"chats.actions.report",defaultMessage:"Report"},deleteForMe:{id:"chats.actions.deleteForMe",defaultMessage:"Delete for me"},blockedBy:{id:"chat_message_list.blockedBy",defaultMessage:"You are blocked by"},networkFailureTitle:{id:"chat_message_list.network_failure.title",defaultMessage:"Whoops!"},networkFailureSubtitle:{id:"chat_message_list.network_failure.subtitle",defaultMessage:"We encountered a network failure."},networkFailureAction:{id:"chat_message_list.network_failure.action",defaultMessage:"Try again"}}),Nn=function(a,t){var n=new Date(a.created_at).getDate(),o=new Date(t.created_at).getDate(),s=new Date().getDate();return n!==o?o===s?"today":"date":null},ht=1e4,Rn=N.forwardRef(function(r,a){r.context;var t=Ze(r,kn);return N.createElement("div",ze({ref:a},t,{className:"mb-2"}))}),In=N.forwardRef(function(r,a){var t=r.style;r.context;var n=Ze(r,Sn);return N.createElement("div",ze({},n,{ref:a,style:vt(vt({},t),{},{scrollbarGutter:"stable"})}))}),En=function(a){var t,n=a.chat,o=ae(),s=Ia(),c=s.account,u=(t=n.latest_read_message_by_account)===null||t===void 0||(t=t.find(function(O){return O.id===(c==null?void 0:c.id)}))===null||t===void 0?void 0:t.date,i=u?new Date(u):null,g=l.useRef(null),d=l.useState(ht-20),m=z(d,2),f=m[0],w=m[1],C=Ae(n.id),x=C.markChatAsRead,y=Ea(n),v=y.data,h=y.fetchNextPage,_=y.hasNextPage,k=y.isError,A=y.isFetching,R=y.isFetchingNextPage,F=y.isLoading,S=y.refetch,E=v||[],p=se(function(O){return O.getIn(["relationships",n.account.id,"blocked_by"])}),V=v?v[v.length-1]:null;l.useEffect(function(){if(v){var O=ht-v.length;w(O)}},[V]);var X=function(){if(!v)return[];var G=new Date().getFullYear();return v.reduce(function(U,b,I){var M=E[I-1],H=new Date(b.created_at);if(M)switch(Nn(M,b)){case"today":U.push({type:"divider",text:o.formatMessage(Ee.today)});break;case"date":U.push({type:"divider",text:o.formatDate(H,{weekday:"short",hour:"numeric",minute:"2-digit",month:"short",day:"numeric",year:H.getFullYear()!==G?"2-digit":void 0})});break}return U.push(b),U},[])},Y=X(),ee=l.useMemo(function(){return{initialTopMostItemIndex:Y.length-1,firstItemIndex:Math.max(0,f)}},[Y.length,f]),j=l.useCallback(function(){return _&&!A&&h(),!1},[f,_,A]),Q=function(G,U){return e(Pa,{text:U,textSize:"xs"},G)};return l.useEffect(function(){var O=E[E.length-1];if(O){var G=O.id,U=O.pending,b=i?i>=new Date(O.created_at):!1;!U&&!b&&x(G)}},[E.length]),p?e(B,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,e(B,{alignItems:"center",space:2},void 0,e(Ge,{src:n.account.avatar,size:75}),e(T,{align:"center"},void 0,N.createElement(N.Fragment,null,e(T,{tag:"span"},void 0,o.formatMessage(Ee.blockedBy))," ",e(T,{tag:"span",theme:"primary"},void 0,"@",n.account.acct))))):k?e(B,{alignItems:"center",justifyContent:"center",className:"h-full grow"},void 0,e(B,{space:4},void 0,e(B,{space:1},void 0,e(T,{size:"lg",weight:"bold",align:"center"},void 0,o.formatMessage(Ee.networkFailureTitle)),e(T,{theme:"muted",align:"center"},void 0,o.formatMessage(Ee.networkFailureSubtitle))),e("div",{className:"mx-auto"},void 0,e(Ke,{theme:"primary",onClick:function(){return S()}},void 0,o.formatMessage(Ee.networkFailureAction))))):F?e("div",{className:"flex grow flex-col justify-end pb-4"},void 0,e("div",{className:"px-4"},void 0,e(Ie,{isMyMessage:!0}),e(Ie,{}),e(Ie,{isMyMessage:!0}),e(Ie,{isMyMessage:!0}),e(Ie,{}))):e("div",{className:"flex h-full grow flex-col space-y-6"},void 0,e("div",{className:"flex grow flex-col justify-end"},void 0,N.createElement(tt,ze({ref:g,alignToBottom:!0},ee,{data:Y,startReached:j,followOutput:"auto",itemContent:function(G,U){return U.type==="divider"?Q(G,U.text):e(_n,{chat:n,chatMessage:U})},components:{List:Rn,Scroller:In,Header:function(){return _||R?e(Dt,{withText:!1}):!_&&!F?e(Mn,{}):null}}}))))},Pe=function(){return Math.floor(Math.random()*65536)},pt=ne({failedToSend:{id:"chat.failed_to_send",defaultMessage:"Message failed to send."},uploadErrorLimit:{id:"upload_error.limit",defaultMessage:"File upload limit exceeded."}}),Pn=function(a){var t,n=(t=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))===null||t===void 0?void 0:t.set;if(n){n.call(a,"");var o=new Event("input",{bubbles:!0});a.dispatchEvent(o)}},Wn=function(a){var t=a.chat,n=a.inputRef,o=a.className,s=ae(),c=he(),u=Ae(t.id),i=u.createChatMessage,g=u.acceptChat,d=se(function(J){return J.instance.configuration.chats.max_media_attachments}),m=l.useState(""),f=z(m,2),w=f[0],C=f[1],x=l.useState([]),y=z(x,2),v=y[0],h=y[1],_=l.useState(0),k=z(_,2),A=k[0],R=k[1],F=l.useState(0),S=z(F,2),E=S[0],p=S[1],V=l.useState(Pe()),X=z(V,2),Y=X[0],ee=X[1],j=l.useState(Pe()),Q=z(j,2),O=Q[0],G=Q[1],U=l.useState(),b=z(U,2),I=b[0],M=b[1],H=w.length===0&&v.length===0,ie=function(){i.mutate({chatId:t.id,content:w,mediaIds:v.map(function(L){return L.id})},{onSuccess:function(){M(void 0)},onError:function(ce,pe,je){var ue,Re=(ue=ce.response)===null||ue===void 0||(ue=ue.data)===null||ue===void 0?void 0:ue.error;M(Re||s.formatMessage(pt.failedToSend)),C(je.prevContent)}}),le()},le=function(){n!=null&&n.current&&Pn(n.current),C(""),h([]),R(0),p(0),G(Pe()),ee(Pe())},Oe=function(){!H&&!i.isLoading&&(ie(),t.accepted||g.mutate())},qe=function(){return C(w+`
`)},$=function(L){L.key==="Enter"&&L.shiftKey?(L.preventDefault(),qe()):L.key==="Enter"&&(L.preventDefault(),Oe())},K=function(L){C(L.target.value)},Se=function(L){H&&L.clipboardData&&L.clipboardData.files.length===1&&lt(L.clipboardData.files)},Le=function(){},Fe=function(){return Le()},Ne=function(L){var ce=Qe(v);ce.splice(L,1),h(ce),G(Pe())},Ye=function(L){var ce=L.loaded,pe=L.total;p(ce/pe)},lt=function(L){if(L.length+v.length>d){Tt.error(pt.uploadErrorLimit);return}R(L.length);var ce=Array.from(L).map(function(){var pe=Ta(regeneratorRuntime.mark(function je(ue){var Re,ct;return regeneratorRuntime.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return Re=new FormData,Re.append("file",ue),be.next=4,c(Oa(Re,Ye));case 4:return ct=be.sent,be.abrupt("return",Aa(ct.data));case 6:case"end":return be.stop()}},je)}));return function(je){return pe.apply(this,arguments)}}());return Promise.all(ce).then(function(pe){h([].concat(Qe(v),Qe(pe))),R(0)}).catch(function(){return R(0)})};return l.useEffect(function(){n!=null&&n.current&&n.current.focus()},[t.id,n==null?void 0:n.current]),e(B,{className:D("flex grow overflow-hidden",o),onMouseOver:Fe},void 0,e("div",{className:"flex h-full grow justify-center overflow-hidden"},void 0,e(En,{chat:t})),N.createElement(fn,{ref:n,onKeyDown:$,value:w,onChange:K,onSubmit:Oe,errorMessage:I,onSelectFile:lt,resetFileKey:O,resetContentKey:Y,onPaste:Se,attachments:v,onDeleteAttachment:Ne,uploadCount:A,uploadProgress:E}))};function Dn(r){const a=La(),t=async(s,c)=>{const i=(c==null?void 0:c.link)||"/api/v1/accounts/search",g=await a.get(i,{params:{q:s,limit:10,followers:!0}}),{data:d}=g,m=Ba(g);return{result:d,link:m,hasMore:!!m}},n=Fa(["search","accounts",r],({pageParam:s})=>t(r,s),{keepPreviousData:!0,getNextPageParam:s=>{if(s.hasMore)return{link:s.link}}}),o=ja(n.data);return{...n,data:o}}var bt=ne({title:{id:"chat_search.blankslate.title",defaultMessage:"Start a chat"},body:{id:"chat_search.blankslate.body",defaultMessage:"Search for someone to chat with."}}),Tn=function(){var a=ae();return e(B,{justifyContent:"center",alignItems:"center",space:2,className:"mx-auto h-full w-2/3"},void 0,e(T,{weight:"bold",size:"lg",align:"center"},void 0,a.formatMessage(bt.title)),e(T,{theme:"muted",align:"center"},void 0,a.formatMessage(bt.body)))},yt=ne({title:{id:"chat_search.empty_results_blankslate.title",defaultMessage:"No matches found"},body:{id:"chat_search.empty_results_blankslate.body",defaultMessage:"Try searching for another name."}}),An=function(){var a=ae();return e(B,{justifyContent:"center",alignItems:"center",space:2,className:"mx-auto h-full w-2/3"},void 0,e(T,{weight:"bold",size:"lg",align:"center","data-testid":"no-results"},void 0,a.formatMessage(yt.title)),e(T,{theme:"muted",align:"center"},void 0,a.formatMessage(yt.body)))},On=function(a){var t=a.accountSearchResult,n=a.onSelect,o=t.data,s=t.isFetching,c=t.hasNextPage,u=t.fetchNextPage,i=l.useState(!1),g=z(i,2),d=g[0],m=g[1],f=l.useState(!0),w=z(f,2),C=w[0],x=w[1],y=function(){c&&!s&&u()},v=l.useCallback(function(h,_){return e("button",{type:"button",className:"flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 dark:hover:bg-gray-800",onClick:function(){return n(_.id)},"data-testid":"account"},_.id,e(W,{alignItems:"center",space:2},void 0,e(Ge,{src:_.avatar,size:40}),e(B,{alignItems:"start"},void 0,e("div",{className:"flex grow items-center space-x-1"},void 0,e(T,{weight:"bold",size:"sm",truncate:!0},void 0,_.display_name),_.verified&&e(At,{})),e(T,{size:"sm",weight:"medium",theme:"muted",truncate:!0},void 0,"@",_.acct))))},[]);return e("div",{className:"relative grow"},void 0,e(tt,{data:o,itemContent:function(_,k){return e("div",{className:"px-2"},void 0,v(_,k))},endReached:y,atTopStateChange:function(_){return x(_)},atBottomStateChange:function(_){return m(_)}}),N.createElement(N.Fragment,null,e("div",{className:D("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":C,"opacity-100":!C})}),e("div",{className:D("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":d,"opacity-100":!d})})))},Ln=ne({placeholder:{id:"chat_search.placeholder",defaultMessage:"Type a name"}}),qn=function(a){var t=ae(),n=a.isMainPage,o=n===void 0?!1:n,s=Wa,c=et(),u=He(),i=u.changeScreen,g=Ot(),d=g.getOrCreateChatByAccountId,m=l.useState(""),f=z(m,2),w=f[0],C=f[1],x=s(w,300),y=Dn(x),v=y.data,h=y.isFetching,_=x&&x.length>0,k=(v||[]).length>0,A=Nt(function(S){return d(S)},{onError:function(E){var p,V=(p=E.response)===null||p===void 0?void 0:p.data;Tt.error(V==null?void 0:V.error)},onSuccess:function(E){o?c.push("/chats/".concat(E.data.id)):i(Ka.CHAT,E.data.id),Rt.invalidateQueries(It.chatSearch())}}),R=function(){return k?e(On,{accountSearchResult:y,onSelect:function(p){A.mutate(p),F()}}):_&&!k&&!h?e(An,{}):e(Tn,{})},F=function(){_&&C("")};return e(B,{space:4,className:"h-full grow"},void 0,e("div",{className:"px-4"},void 0,e(Lt,{"data-testid":"search",type:"text",autoFocus:!0,placeholder:t.formatMessage(Ln.placeholder),value:w||"",onChange:function(E){return C(E.target.value)},outerClassName:"mt-0",theme:"search",append:e("button",{onClick:F},void 0,e(re,{src:_?Xe:Ft,className:"h-4 w-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))})),e(B,{className:"grow"},void 0,R()))},Be=function(){return e("div",{className:"flex w-full animate-pulse flex-col px-4 py-2"},void 0,e(W,{alignItems:"center",space:2},void 0,e(kt,{size:40}),e(B,{alignItems:"start"},void 0,e(Ua,{minLength:3,maxLength:15}))))},Ce=ne({blockedYou:{id:"chat_list_item.blocked_you",defaultMessage:"This user has blocked you"},blocking:{id:"chat_list_item.blocking",defaultMessage:"You have blocked this user"},leaveMessage:{id:"chat_settings.leave.message",defaultMessage:"Are you sure you want to leave this chat? Messages will be deleted for you and this chat will be removed from your inbox."},leaveHeading:{id:"chat_settings.leave.heading",defaultMessage:"Leave Chat"},leaveConfirm:{id:"chat_settings.leave.confirm",defaultMessage:"Leave Chat"},leaveChat:{id:"chat_settings.options.leave_chat",defaultMessage:"Leave Chat"}}),Fn=function(a){var t,n,o,s,c,u=a.chat,i=a.onClick,g=he(),d=ae(),m=Ve(),f=et(),w=He(),C=w.isUsingMainChatPage,x=Ae(u==null?void 0:u.id),y=x.deleteChat,v=se(function(A){return A.getIn(["relationships",u.account.id,"blocked_by"])}),h=se(function(A){var R;return A.getIn(["relationships",u==null||(R=u.account)===null||R===void 0?void 0:R.id,"blocking"])}),_=l.useMemo(function(){return[{text:d.formatMessage(Ce.leaveChat),action:function(R){R.stopPropagation(),g(Te("CONFIRM",{heading:d.formatMessage(Ce.leaveHeading),message:d.formatMessage(Ce.leaveMessage),confirm:d.formatMessage(Ce.leaveConfirm),confirmationTheme:"primary",onConfirm:function(){y.mutate(void 0,{onSuccess:function(){C&&f.push("/chats")}})}}))},icon:$a}]},[]),k=function(R){(R.key==="Enter"||R.key===" ")&&i(u)};return e("div",{role:"button",onClick:function(){return i(u)},onKeyDown:k,className:"group flex w-full flex-col rounded-lg px-2 py-3 hover:bg-gray-100 focus:shadow-inset-ring dark:hover:bg-gray-800","data-testid":"chat-list-item",tabIndex:0},u.id,e(W,{alignItems:"center",justifyContent:"between",space:2,className:"w-full"},void 0,e(W,{alignItems:"center",space:2,className:"overflow-hidden"},void 0,e(Ge,{src:(t=u.account)===null||t===void 0?void 0:t.avatar,size:40,className:"flex-none"}),e(B,{alignItems:"start",className:"overflow-hidden"},void 0,e("div",{className:"flex w-full grow items-center space-x-1"},void 0,e(T,{weight:"bold",size:"sm",align:"left",truncate:!0},void 0,((n=u.account)===null||n===void 0?void 0:n.display_name)||"@".concat(u.account.username)),((o=u.account)===null||o===void 0?void 0:o.verified)&&e(At,{})),v||h?e(T,{align:"left",size:"sm",weight:"medium",theme:"muted",truncate:!0,className:"pointer-events-none h-5 w-full italic","data-testid":"chat-last-message"},void 0,d.formatMessage(v?Ce.blockedYou:Ce.blocking)):N.createElement(N.Fragment,null,((s=u.last_message)===null||s===void 0?void 0:s.content)&&e(T,{align:"left",size:"sm",weight:"medium",theme:u.last_message.unread?"default":"muted",truncate:!0,className:"truncate-child pointer-events-none h-5 w-full","data-testid":"chat-last-message",dangerouslySetInnerHTML:{__html:(c=u.last_message)===null||c===void 0?void 0:c.content}})))),e(W,{alignItems:"center",space:2},void 0,m.chatsDelete&&e("div",{className:"hidden text-gray-600 hover:text-gray-100 group-hover:block"},void 0,e(Et,{items:_},void 0,e(Mt,{src:Pt,title:"Settings",className:"text-gray-600 hover:text-gray-700 dark:text-gray-600 dark:hover:text-gray-500",iconClassName:"h-4 w-4"}))),u.last_message&&N.createElement(N.Fragment,null,u.last_message.unread&&e("div",{className:"h-2 w-2 rounded-full bg-secondary-500","data-testid":"chat-unread-indicator"}),e(za,{timestamp:u.last_message.created_at,align:"right",size:"xs",theme:u.last_message.unread?"default":"muted",truncate:!0})))))},Yn=function(a){var t=a.onClickChat,n=a.useWindowScroll,o=n===void 0?!1:n,s=a.searchValue,c=he(),u=l.useRef(null),i=Ot(s),g=i.chatsQuery,d=g.data,m=g.isFetching,f=g.hasNextPage,w=g.fetchNextPage,C=l.useState(!1),x=z(C,2),y=x[0],v=x[1],h=l.useState(!0),_=z(h,2),k=_[0],A=_[1],R=function(){f&&!m&&w()},F=function(){return c(Va())},S=function(){return m?e(B,{space:2},void 0,e(Be,{}),e(Be,{}),e(Be,{})):null};return e("div",{className:"relative h-full"},void 0,e(qa,{onRefresh:F},void 0,N.createElement(tt,{ref:u,atTopStateChange:function(p){return A(p)},atBottomStateChange:function(p){return v(p)},useWindowScroll:o,data:d,endReached:R,itemContent:function(p,V){return e("div",{className:"px-2"},void 0,e(Fn,{chat:V,onClick:t}))},components:{ScrollSeekPlaceholder:function(){return e(Be,{})},Footer:function(){return f?e(Dt,{withText:!1}):null},EmptyPlaceholder:S}})),N.createElement(N.Fragment,null,e("div",{className:D("pointer-events-none absolute inset-x-0 top-0 flex justify-center rounded-t-lg bg-gradient-to-b from-white to-transparent pb-12 pt-8 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":k,"opacity-100":!k})}),e("div",{className:D("pointer-events-none absolute inset-x-0 bottom-0 flex justify-center rounded-b-lg bg-gradient-to-t from-white to-transparent pb-8 pt-12 transition-opacity duration-500 dark:from-gray-900",{"opacity-0":y,"opacity-100":!y})})))},jn=ne({searchPlaceholder:{id:"chats.search_placeholder",defaultMessage:"Search inbox"}}),Qn=function(a){var t=a.value,n=a.onChange,o=a.onClear,s=ae();return e(Lt,{"data-testid":"chat-search-input",type:"text",autoFocus:!0,placeholder:s.formatMessage(jn.searchPlaceholder),className:"rounded-full",value:t,onChange:n,outerClassName:"mt-0",theme:"search",append:e("button",{onClick:o},void 0,e(re,{src:t.length?Xe:Ft,className:"h-4 w-4 text-gray-700 dark:text-gray-600","aria-hidden":"true"}))})};export{Wn as C,An as E,qn as a,Qn as b,Yn as c};
