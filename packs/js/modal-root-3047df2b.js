import{u as J,a9 as X,d as Z,r as C,ax as $,ee as K,R as U,W as q,a as p,aH as z,aL as B,F as O,bx as k,ec as ee,ef as te,eg as ne,eh as ie,bN as re,_ as ae,o as oe}from"../index-7f7c5db0.js";var T=function(){function u(r,a){for(var l=0;l<a.length;l++){var h=a[l];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(r,h.key,h)}}return function(r,a,l){return a&&u(r.prototype,a),l&&u(r,l),r}}();function S(u,r){if(!(u instanceof r))throw new TypeError("Cannot call a class as a function")}(function(){if(typeof window>"u")return;var u=Array.prototype.slice,r=Element.prototype.matches||Element.prototype.msMatchesSelector,a=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","details","summary","iframe","object","embed","[contenteditable]"].join(","),l=function(){function d(t,e){S(this,d),this._inertManager=e,this._rootElement=t,this._managedNodes=new Set,this._rootElement.hasAttribute("aria-hidden")?this._savedAriaHidden=this._rootElement.getAttribute("aria-hidden"):this._savedAriaHidden=null,this._rootElement.setAttribute("aria-hidden","true"),this._makeSubtreeUnfocusable(this._rootElement),this._observer=new MutationObserver(this._onMutation.bind(this)),this._observer.observe(this._rootElement,{attributes:!0,childList:!0,subtree:!0})}return T(d,[{key:"destructor",value:function(){this._observer.disconnect(),this._rootElement&&(this._savedAriaHidden!==null?this._rootElement.setAttribute("aria-hidden",this._savedAriaHidden):this._rootElement.removeAttribute("aria-hidden")),this._managedNodes.forEach(function(e){this._unmanageNode(e.node)},this),this._observer=null,this._rootElement=null,this._managedNodes=null,this._inertManager=null}},{key:"_makeSubtreeUnfocusable",value:function(e){var i=this;N(e,function(f){return i._visitNode(f)});var n=document.activeElement;if(!document.body.contains(e)){for(var o=e,c=void 0;o;){if(o.nodeType===Node.DOCUMENT_FRAGMENT_NODE){c=o;break}o=o.parentNode}c&&(n=c.activeElement)}e.contains(n)&&(n.blur(),n===document.activeElement&&document.body.focus())}},{key:"_visitNode",value:function(e){if(e.nodeType===Node.ELEMENT_NODE){var i=e;i!==this._rootElement&&i.hasAttribute("inert")&&this._adoptInertRoot(i),(r.call(i,a)||i.hasAttribute("tabindex"))&&this._manageNode(i)}}},{key:"_manageNode",value:function(e){var i=this._inertManager.register(e,this);this._managedNodes.add(i)}},{key:"_unmanageNode",value:function(e){var i=this._inertManager.deregister(e,this);i&&this._managedNodes.delete(i)}},{key:"_unmanageSubtree",value:function(e){var i=this;N(e,function(n){return i._unmanageNode(n)})}},{key:"_adoptInertRoot",value:function(e){var i=this._inertManager.getInertRoot(e);i||(this._inertManager.setInert(e,!0),i=this._inertManager.getInertRoot(e)),i.managedNodes.forEach(function(n){this._manageNode(n.node)},this)}},{key:"_onMutation",value:function(e,i){e.forEach(function(n){var o=n.target;if(n.type==="childList")u.call(n.addedNodes).forEach(function(f){this._makeSubtreeUnfocusable(f)},this),u.call(n.removedNodes).forEach(function(f){this._unmanageSubtree(f)},this);else if(n.type==="attributes"){if(n.attributeName==="tabindex")this._manageNode(o);else if(o!==this._rootElement&&n.attributeName==="inert"&&o.hasAttribute("inert")){this._adoptInertRoot(o);var c=this._inertManager.getInertRoot(o);this._managedNodes.forEach(function(f){o.contains(f.node)&&c._manageNode(f.node)})}}},this)}},{key:"managedNodes",get:function(){return new Set(this._managedNodes)}},{key:"hasSavedAriaHidden",get:function(){return this._savedAriaHidden!==null}},{key:"savedAriaHidden",set:function(e){this._savedAriaHidden=e},get:function(){return this._savedAriaHidden}}]),d}(),h=function(){function d(t,e){S(this,d),this._node=t,this._overrodeFocusMethod=!1,this._inertRoots=new Set([e]),this._savedTabIndex=null,this._destroyed=!1,this.ensureUntabbable()}return T(d,[{key:"destructor",value:function(){if(this._throwIfDestroyed(),this._node&&this._node.nodeType===Node.ELEMENT_NODE){var e=this._node;this._savedTabIndex!==null?e.setAttribute("tabindex",this._savedTabIndex):e.removeAttribute("tabindex"),this._overrodeFocusMethod&&delete e.focus}this._node=null,this._inertRoots=null,this._destroyed=!0}},{key:"_throwIfDestroyed",value:function(){if(this.destroyed)throw new Error("Trying to access destroyed InertNode")}},{key:"ensureUntabbable",value:function(){if(this.node.nodeType===Node.ELEMENT_NODE){var e=this.node;if(r.call(e,a)){if(e.tabIndex===-1&&this.hasSavedTabIndex)return;e.hasAttribute("tabindex")&&(this._savedTabIndex=e.tabIndex),e.setAttribute("tabindex","-1"),e.nodeType===Node.ELEMENT_NODE&&(e.focus=function(){},this._overrodeFocusMethod=!0)}else e.hasAttribute("tabindex")&&(this._savedTabIndex=e.tabIndex,e.removeAttribute("tabindex"))}}},{key:"addInertRoot",value:function(e){this._throwIfDestroyed(),this._inertRoots.add(e)}},{key:"removeInertRoot",value:function(e){this._throwIfDestroyed(),this._inertRoots.delete(e),this._inertRoots.size===0&&this.destructor()}},{key:"destroyed",get:function(){return this._destroyed}},{key:"hasSavedTabIndex",get:function(){return this._savedTabIndex!==null}},{key:"node",get:function(){return this._throwIfDestroyed(),this._node}},{key:"savedTabIndex",set:function(e){this._throwIfDestroyed(),this._savedTabIndex=e},get:function(){return this._throwIfDestroyed(),this._savedTabIndex}}]),d}(),E=function(){function d(t){if(S(this,d),!t)throw new Error("Missing required argument; InertManager needs to wrap a document.");this._document=t,this._managedNodes=new Map,this._inertRoots=new Map,this._observer=new MutationObserver(this._watchForInert.bind(this)),M(t.head||t.body||t.documentElement),t.readyState==="loading"?t.addEventListener("DOMContentLoaded",this._onDocumentLoaded.bind(this)):this._onDocumentLoaded()}return T(d,[{key:"setInert",value:function(e,i){if(i){if(this._inertRoots.has(e))return;var n=new l(e,this);if(e.setAttribute("inert",""),this._inertRoots.set(e,n),!this._document.body.contains(e))for(var o=e.parentNode;o;)o.nodeType===11&&M(o),o=o.parentNode}else{if(!this._inertRoots.has(e))return;var c=this._inertRoots.get(e);c.destructor(),this._inertRoots.delete(e),e.removeAttribute("inert")}}},{key:"getInertRoot",value:function(e){return this._inertRoots.get(e)}},{key:"register",value:function(e,i){var n=this._managedNodes.get(e);return n!==void 0?n.addInertRoot(i):n=new h(e,i),this._managedNodes.set(e,n),n}},{key:"deregister",value:function(e,i){var n=this._managedNodes.get(e);return n?(n.removeInertRoot(i),n.destroyed&&this._managedNodes.delete(e),n):null}},{key:"_onDocumentLoaded",value:function(){var e=u.call(this._document.querySelectorAll("[inert]"));e.forEach(function(i){this.setInert(i,!0)},this),this._observer.observe(this._document.body||this._document.documentElement,{attributes:!0,subtree:!0,childList:!0})}},{key:"_watchForInert",value:function(e,i){var n=this;e.forEach(function(o){switch(o.type){case"childList":u.call(o.addedNodes).forEach(function(g){if(g.nodeType===Node.ELEMENT_NODE){var b=u.call(g.querySelectorAll("[inert]"));r.call(g,"[inert]")&&b.unshift(g),b.forEach(function(w){this.setInert(w,!0)},n)}},n);break;case"attributes":if(o.attributeName!=="inert")return;var c=o.target,f=c.hasAttribute("inert");n.setInert(c,f);break}},this)}}]),d}();function N(d,t,e){if(d.nodeType==Node.ELEMENT_NODE){var i=d;t&&t(i);var n=i.shadowRoot;if(n){N(n,t);return}if(i.localName=="content"){for(var o=i,c=o.getDistributedNodes?o.getDistributedNodes():[],f=0;f<c.length;f++)N(c[f],t);return}if(i.localName=="slot"){for(var g=i,b=g.assignedNodes?g.assignedNodes({flatten:!0}):[],w=0;w<b.length;w++)N(b[w],t);return}}for(var I=d.firstChild;I!=null;)N(I,t),I=I.nextSibling}function M(d){if(!d.querySelector("style#inert-style, link#inert-style")){var t=document.createElement("style");t.setAttribute("id","inert-style"),t.textContent=`
[inert] {
  pointer-events: none;
  cursor: default;
}

[inert], [inert] * {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
`,d.appendChild(t)}}if(!HTMLElement.prototype.hasOwnProperty("inert")){var y=new E(document);Object.defineProperty(HTMLElement.prototype,"inert",{enumerable:!0,get:function(){return this.hasAttribute("inert")},set:function(t){y.setInert(this,t)}})}})();function V(u,r){var a=Object.keys(u);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(u);r&&(l=l.filter(function(h){return Object.getOwnPropertyDescriptor(u,h).enumerable})),a.push.apply(a,l)}return a}function W(u){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?V(Object(a),!0).forEach(function(l){ae(u,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(a)):V(Object(a)).forEach(function(l){Object.defineProperty(u,l,Object.getOwnPropertyDescriptor(a,l))})}return u}var L=oe({confirm:{id:"confirmations.cancel.confirm",defaultMessage:"Discard"},cancelEditing:{id:"confirmations.cancel_editing.confirm",defaultMessage:"Cancel editing"}}),se=function(r){return!!r&&[r.text.length>0,r.spoiler_text.length>0,r.media_attachments.size>0,r.poll!==null].some(function(a){return a===!0})},ue=function(r){return!!r&&[r.name.length>0,r.status.length>0,r.location!==null,r.banner!==null].some(function(a){return a===!0})},le=function(r){var a=r.children,l=r.onCancel,h=r.onClose,E=r.type,N=J(),M=X(),y=Z(),d=C.useState(!!a),t=$(d,2),e=t[0],i=t[1],n=C.useRef(null),o=C.useRef(e?document.activeElement:null),c=C.useRef(),f=C.useRef(),g=K(a);K(E);var b=!!a,w=function(s){(s.key==="Escape"||s.key==="Esc"||s.keyCode===27)&&I()},I=function(){y(function(s,_){var m=_().compose.get("compose-modal"),A=se(m),j=ue(_().compose_event);if(A&&E==="COMPOSE"){var F=m.id!==null;y(z("CONFIRM",{icon:B,heading:F?p(O,{id:"confirmations.cancel_editing.heading",defaultMessage:"Cancel post editing"}):p(O,{id:"confirmations.cancel.heading",defaultMessage:"Discard post"}),message:F?p(O,{id:"confirmations.cancel_editing.message",defaultMessage:"Are you sure you want to cancel editing this post? All changes will be lost."}):p(O,{id:"confirmations.cancel.message",defaultMessage:"Are you sure you want to cancel creating this post?"}),confirm:N.formatMessage(L.confirm),onConfirm:function(){y(k("COMPOSE")),y(ee())},onCancel:function(){y(k("CONFIRM"))}}))}else if(j&&E==="COMPOSE_EVENT"){var R=_().compose_event.id!==null;y(z("CONFIRM",{icon:B,heading:R?p(O,{id:"confirmations.cancel_event_editing.heading",defaultMessage:"Cancel event editing"}):p(O,{id:"confirmations.delete_event.heading",defaultMessage:"Delete event"}),message:R?p(O,{id:"confirmations.cancel_event_editing.message",defaultMessage:"Are you sure you want to cancel editing this event? All changes will be lost."}):p(O,{id:"confirmations.delete_event.message",defaultMessage:"Are you sure you want to delete this event?"}),confirm:N.formatMessage(R?L.cancelEditing:L.confirm),onConfirm:function(){y(k("COMPOSE_EVENT")),y(te())},onCancel:function(){y(k("CONFIRM"))}}))}else if((A||j)&&E==="CONFIRM")y(k("CONFIRM"));else if(E==="POLICY"){var x=ne.getQueryData(ie.policy);if(x!=null&&x.pending_policy_id)return;h()}else h()})},P=C.useCallback(function(v){if(v.key==="Tab"){var s=Array.from(n.current.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(function(A){return window.getComputedStyle(A).display!=="none"}),_=s.indexOf(v.target),m;v.shiftKey?m=s[_-1]||s[s.length-1]:m=s[_+1]||s[0],m&&(m.focus(),v.stopPropagation(),v.preventDefault())}},[]),G=function(){c.current=Date.now(),f.current=M.listen(function(s,_){var m=s.state;m!=null&&m.soapboxModalKey?_==="POP"&&(I(),l&&l()):h()})},Q=function(s){f.current&&f.current();var _=M.location.state;_&&_.soapboxModalKey===c.current&&M.goBack()},Y=function(){var s=M.location,_=s.pathname,m=s.state;(!m||m.soapboxModalKey!==c.current)&&M.push(_,W(W({},m),{},{soapboxModalKey:c.current}))},H=function(){return Array.apply(void 0,re(n.current.parentElement.childNodes)).filter(function(s){return s.id!=="toaster"}).filter(function(s){return s!==n.current})};return C.useEffect(function(){if(b)return window.addEventListener("keyup",w,!1),window.addEventListener("keydown",P,!1),function(){window.removeEventListener("keyup",w),window.removeEventListener("keydown",P)}},[b]),C.useEffect(function(){if(a&&!g?(o.current=document.activeElement,H().forEach(function(s){return s.setAttribute("inert","true")}),G()):g||i(!1),!a&&g){var v;(v=o.current)===null||v===void 0||v.focus(),o.current=null,H().forEach(function(s){return s.removeAttribute("inert")}),Q()}a&&(requestAnimationFrame(function(){i(!0)}),Y())},[a]),b?U.createElement("div",{ref:n,className:q({"fixed top-0 left-0 z-[100] w-full h-full overflow-x-hidden overflow-y-auto":!0,"pointer-events-none":!b}),style:{opacity:e?1:0}},p("div",{role:"presentation",id:"modal-overlay",className:"fixed inset-0 bg-gray-500/90 backdrop-blur dark:bg-gray-700/90",onClick:I}),p("div",{role:"dialog",className:q({"my-2 mx-auto relative pointer-events-none flex items-center min-h-[calc(100%-3.5rem)]":!0,"p-4 md:p-0":E!=="MEDIA","!my-0":E==="MEDIA"})},void 0,a)):U.createElement("div",{className:"z-50 transition-all",ref:n,style:{opacity:0}})};export{le as M,ue as a,se as c};
