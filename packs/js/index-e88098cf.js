var ft=Object.defineProperty;var mt=(p,t,o)=>t in p?ft(p,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):p[t]=o;var z=(p,t,o)=>(mt(p,typeof t!="symbol"?t+"":t,o),o);import{v as ht}from"./download-ac53125a.js";import{u as gt,r as i,at as y,Q as _t,cl as ne,R as M,W as G,a as s,I as X,dx as yt,dy as pt,dk as bt,o as wt}from"../index-7380452a.js";import{v as Mt}from"./volume-08f8a8f1.js";import{g as Ae,v as Ct,f as Ie}from"./index-486dc940.js";import"./arrows-minimize-7c27a12c.js";import"./web.url.constructor-8f9eaf9c.js";import"./object-assign-7ac9a0a3.js";import"./es.array.last-index-of-ca8fdd84.js";import"./media-aspect-ratio-df6a7bb1.js";const kt=(p,t=1)=>{const[o,u,l]=p.match(/\w\w/g).map(v=>parseInt(v,16));return`rgba(${o}, ${u}, ${l}, ${t})`};class St{constructor(t){z(this,"tickSize");z(this,"canvas");z(this,"context");z(this,"analyser");this.tickSize=t}setCanvas(t){this.canvas=t,t&&(this.context=t.getContext("2d"))}setAudioContext(t,o){const u=t.createAnalyser();u.smoothingTimeConstant=.6,u.fftSize=2048,o.connect(u),this.analyser=u}getTickPoints(t){const o=[];for(let u=0;u<t;u++){const l=Math.PI*2*u/t;o.push({x:Math.cos(l),y:-Math.sin(l)})}return o}drawTick(t,o,u,l,v,b,g){const x=Math.ceil(t+l),C=Math.ceil(o+v),_=Math.ceil(t+b),E=Math.ceil(o+g),c=this.context.createLinearGradient(x,C,_,E),f=kt(u,0);c.addColorStop(0,u),c.addColorStop(.6,u),c.addColorStop(1,f),this.context.beginPath(),this.context.strokeStyle=c,this.context.lineWidth=2,this.context.moveTo(x,C),this.context.lineTo(_,E),this.context.stroke()}getTicks(t,o,u,l){const v=this.getTickPoints(t),b=200,g=[],x=this.analyser?this.analyser.frequencyBinCount:0,C=new Uint8Array(x),_=[];this.analyser&&this.analyser.getByteFrequencyData(C),v.forEach((c,f)=>{const k=1-f/(v.length*2.5);let w=((C[f]||0)-b*k)*l;w<0&&(w=0);const B=u/(u-(o+w)),T=c.x*(u-o),K=c.y*(u-o),U=T*B,A=K*B;if(g.push({x1:T,y1:K,x2:U,y2:A}),f<20){let d=w/(200*l);d=d<1?1:d,_.push(d)}});const E=_.reduce((c,f)=>c+f,0)/_.length;return g.map(({x1:c,y1:f,x2:k,y2:w})=>({x1:c,y1:f,x2:k*E,y2:w*E}))}clear(t,o){this.context.clearRect(0,0,t,o)}draw(t,o,u,l,v){this.context.save(),this.getTicks(parseInt(360*v),this.tickSize,l,v).forEach(g=>{this.drawTick(t,o,u,g.x1,g.y1,g.x2,g.y2)}),this.context.restore()}}var h=wt({play:{id:"video.play",defaultMessage:"Play"},pause:{id:"video.pause",defaultMessage:"Pause"},mute:{id:"video.mute",defaultMessage:"Mute sound"},unmute:{id:"video.unmute",defaultMessage:"Unmute sound"},download:{id:"video.download",defaultMessage:"Download file"},hide:{id:"audio.hide",defaultMessage:"Hide audio"},expand:{id:"audio.expand",defaultMessage:"Expand audio"}}),re=10,$e=180,$t=function(t){var o=t.src,u=t.alt,l=u===void 0?"":u,v=t.poster,b=t.accentColor,g=t.backgroundColor,x=t.foregroundColor,C=t.cacheWidth,_=t.fullscreen,E=t.autoPlay,c=t.editable,f=t.deployPictureInPicture,k=f===void 0?!1:f,w=t.sensitiveOverlay,B=w===void 0?null:w,T=t.onToggleVisibility,K=T===void 0?function(){}:T,U=t.visible,A=U===void 0?!0:U,d=gt(),Ve=i.useState(t.width),ae=y(Ve,2),F=ae[0],qe=ae[1],ze=i.useState(t.height),oe=y(ze,2),D=oe[0],Be=oe[1],Ke=i.useState(0),ue=y(Ke,2),H=ue[0],Y=ue[1],Ue=i.useState(0),ie=y(Ue,2),Fe=ie[0],He=ie[1],We=i.useState(void 0),se=y(We,2),Oe=se[0],le=se[1],je=i.useState(!0),ce=y(je,2),S=ce[0],W=ce[1],Ge=i.useState(!1),de=y(Ge,2),L=de[0],ve=de[1],Xe=i.useState(.5),fe=y(Xe,2),O=fe[0],me=fe[1],Ye=i.useState(!1),he=y(Ye,2),Qe=he[0],ge=he[1],Ze=i.useState(!1),_e=y(Ze,2),ye=_e[0],pe=_e[1],N=i.useRef(new St(re)),I=i.useRef(null),P=i.useRef(null),r=i.useRef(null),Q=i.useRef(null),Z=i.useRef(null),R=i.useRef(null),be=function(){var e,a,m;return{src:t.src,volume:(e=r.current)===null||e===void 0?void 0:e.volume,muted:(a=r.current)===null||a===void 0?void 0:a.muted,currentTime:(m=r.current)===null||m===void 0?void 0:m.currentTime,poster:t.poster,backgroundColor:t.backgroundColor,foregroundColor:t.foregroundColor,accentColor:t.accentColor}},we=function(){if(P.current){var e=P.current.offsetWidth,a=_?P.current.offsetHeight:e/(16/9);C&&C(e),qe(e),Be(a)}},$=function(){if(I.current||st(),S){var e;(e=r.current)===null||e===void 0||e.play()}else{var a;(a=r.current)===null||a===void 0||a.pause()}W(!S)},Me=_t(function(){P.current&&we()},250,{trailing:!0}),Je=function(){var e;if(W(!1),((e=I.current)===null||e===void 0?void 0:e.state)==="suspended"){var a;(a=I.current)===null||a===void 0||a.resume()}lt()},et=function(){var e;W(!0),(e=I.current)===null||e===void 0||e.suspend()},tt=function(){if(r.current){var e=r.current.buffered.length-1;e>-1&&He(Math.ceil(r.current.buffered.end(e)/r.current.duration*100))}},Ce=function(){var e=!L;ve(e),r.current&&(r.current.muted=e)},nt=function(e){document.addEventListener("mousemove",q,!0),document.addEventListener("mouseup",ke,!0),document.addEventListener("touchmove",q,!0),document.addEventListener("touchend",ke,!0),q(e),e.preventDefault(),e.stopPropagation()},ke=function n(){document.removeEventListener("mousemove",q,!0),document.removeEventListener("mouseup",n,!0),document.removeEventListener("touchmove",q,!0),document.removeEventListener("touchend",n,!0)},rt=function(e){var a;document.addEventListener("mousemove",V,!0),document.addEventListener("mouseup",Se,!0),document.addEventListener("touchmove",V,!0),document.addEventListener("touchend",Se,!0),ge(!0),(a=r.current)===null||a===void 0||a.pause(),V(e),e.preventDefault(),e.stopPropagation()},Se=function n(){var e;document.removeEventListener("mousemove",V,!0),document.removeEventListener("mouseup",n,!0),document.removeEventListener("touchmove",V,!0),document.removeEventListener("touchend",n,!0),ge(!1),(e=r.current)===null||e===void 0||e.play()},V=ne(function(n){if(r.current&&Q.current){var e=Ae(Q.current,n),a=e.x,m=r.current.duration*a;isNaN(m)||(Y(m),r.current.currentTime=m)}},15),at=function(){r.current&&(Y(r.current.currentTime),le(r.current.duration))},q=ne(function(n){if(r.current&&Z.current){var e=Ae(Z.current,n),a=e.x;isNaN(a)||(me(a),r.current.volume=a)}},15),Ee=ne(function(){if(!(!R.current||!r.current)){var n=R.current.getBoundingClientRect(),e=n.top,a=n.height,m=e<=(window.innerHeight||document.documentElement.clientHeight)&&e+a>=0;!S&&!m&&(r.current.pause(),k&&k("audio",be()),W(!0))}},150,{trailing:!0}),ot=function(){pe(!0)},ut=function(){pe(!1)},it=function(){r.current&&(le(r.current.duration),H&&(r.current.currentTime=H),O!==void 0&&(r.current.volume=O),L!==void 0&&(r.current.muted=L),E&&$())},st=function(){if(r.current){var e=window.AudioContext||window.webkitAudioContext,a=new e,m=a.createMediaElementSource(r.current);N.current.setAudioContext(a,m),m.connect(a.destination),I.current=a}},lt=function n(){requestAnimationFrame(function(){r.current&&(at(),Pe(),xe(),S||n())})},Pe=function(){var e;(e=N.current)===null||e===void 0||e.clear(F||0,D||0)},xe=function(){var e;(e=N.current)===null||e===void 0||e.draw(De(),Le(),ee(),j(),J())},j=function(){return((D||t.height||0)-$e*J()*2)/2},J=function(){return(D||t.height||0)/982},De=function(){return Math.floor((F||0)/2)},Le=function(){return Math.floor(j()+$e*J())},ee=function(){return b||"#ffffff"},ct=function(){return g||"#000000"},dt=function(){return x||"#ffffff"},Ne=function(e){if(r.current){var a=r.current.currentTime+e;isNaN(a)||(Y(a),r.current.currentTime=a)}},Re=function(e){e.key===" "&&(e.preventDefault(),e.stopPropagation(),$())},vt=function(e){switch(e.key){case"k":e.preventDefault(),e.stopPropagation(),$();break;case"m":e.preventDefault(),e.stopPropagation(),Ce();break;case"j":e.preventDefault(),e.stopPropagation(),Ne(-10);break;case"l":e.preventDefault(),e.stopPropagation(),Ne(10);break}},te=function(){return Oe||t.duration},Te=Math.min(H/(te()||0)*100,100);return i.useLayoutEffect(function(){P.current&&we()},[P.current]),i.useEffect(function(){r.current&&(me(r.current.volume),ve(r.current.muted))},[r.current]),i.useEffect(function(){R.current&&N.current&&N.current.setCanvas(R.current)},[R.current,N.current]),i.useEffect(function(){return window.addEventListener("scroll",Ee),window.addEventListener("resize",Me,{passive:!0}),function(){window.removeEventListener("scroll",Ee),window.removeEventListener("resize",Me),!S&&r.current&&k&&k("audio",be())}},[]),i.useEffect(function(){Pe(),xe()},[o,F,D,b]),i.useEffect(function(){if(!A){var n;(n=r.current)===null||n===void 0||n.pause()}},[A]),M.createElement("div",{className:G("audio-player",{editable:c}),ref:P,style:{backgroundColor:ct(),color:dt(),width:"100%",height:_?"100%":D||t.height},onMouseEnter:ot,onMouseLeave:ut,tabIndex:0,onKeyDown:vt,onClick:function(e){return e.stopPropagation()}},B,M.createElement("audio",{src:o,ref:r,preload:"auto",onPlay:Je,onPause:et,onProgress:tt,onLoadedData:it}),A&&M.createElement(M.Fragment,null,M.createElement("canvas",{role:"button",tabIndex:0,className:"audio-player__canvas absolute left-0 top-0 w-full",width:F,height:D,ref:R,onClick:$,onKeyDown:Re,title:l,"aria-label":l}),v&&s("img",{src:v,alt:"",className:"pointer-events-none absolute aspect-1 -translate-x-1/2 -translate-y-1/2 rounded-full object-cover",width:(j()-re)*2,height:(j()-re)*2,style:{left:De(),top:Le()}}),M.createElement("div",{className:"video-player__seek",onMouseDown:rt,ref:Q},s("div",{className:"video-player__seek__buffer",style:{width:"".concat(Fe,"%")}}),s("div",{className:"video-player__seek__progress",style:{width:"".concat(Te,"%"),backgroundColor:b}}),s("span",{className:G("video-player__seek__handle",{active:Qe}),tabIndex:0,style:{left:"".concat(Te,"%"),backgroundColor:b},onKeyDown:Re})),s("div",{className:"video-player__controls active"},void 0,s("div",{className:"video-player__buttons-bar"},void 0,s("div",{className:"video-player__buttons left"},void 0,s("button",{type:"button",title:d.formatMessage(S?h.play:h.pause),"aria-label":d.formatMessage(S?h.play:h.pause),className:"player-button",onClick:$},void 0,s(X,{src:S?yt:Ct})),s("button",{type:"button",title:d.formatMessage(L?h.unmute:h.mute),"aria-label":d.formatMessage(L?h.unmute:h.mute),className:G("player-button volume_button",{active:ye}),onClick:Ce},void 0,s(X,{src:L?pt:Mt})),M.createElement("div",{className:G("video-player__volume",{active:ye}),ref:Z,onMouseDown:nt},s("div",{className:"video-player__volume__current",style:{width:"".concat(O*100,"%"),backgroundColor:ee()}}),s("span",{className:"video-player__volume__handle",tabIndex:0,style:{left:"".concat(O*100,"%"),backgroundColor:ee()}})),s("span",{className:"video-player__time"},void 0,s("span",{className:"video-player__time-current"},void 0,Ie(Math.floor(H))),typeof te()<"u"&&M.createElement(M.Fragment,null,s("span",{className:"video-player__time-sep"},void 0,"/"),s("span",{className:"video-player__time-total"},void 0,Ie(Math.floor(te()||0)))))),s("div",{className:"video-player__buttons right"},void 0,!_&&s("button",{type:"button",title:d.formatMessage(h.hide),"aria-label":d.formatMessage(h.hide),className:"video-player__download__icon player-button",onClick:K},void 0,s(X,{src:bt})),s("a",{title:d.formatMessage(h.download),"aria-label":d.formatMessage(h.download),className:"video-player__download__icon player-button",href:o,download:!0,target:"_blank"},void 0,s(X,{src:ht})))))))};export{$t as default};
